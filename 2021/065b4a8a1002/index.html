<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222" media="(prefers-color-scheme: light)">
<meta name="theme-color" content="#222" media="(prefers-color-scheme: dark)"><meta name="generator" content="Hexo 5.4.2">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">
  <meta name="google-site-verification" content="UMgeGAOIi3I5Ncgc_2ZRy-AIufQL7eZNutKIai7M5g8">
  <meta name="baidu-site-verification" content="code-sZmaqxmBhP">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.2.0/css/all.min.css" integrity="sha256-AbA177XfpSnFEvgpYu1jMygiLabzPCJCRIBtR5jGc0k=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"jeremyhzf.com","root":"/","images":"/images","scheme":"Pisces","darkmode":true,"version":"8.13.1","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12},"copycode":{"enable":true,"style":"mac"},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":true,"pangu":false,"comments":{"style":"tabs","active":"gitalk","storage":true,"lazyload":true,"nav":null,"activeClass":"gitalk"},"stickytabs":false,"motion":{"enable":false,"async":false,"transition":{"post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"}}</script><script src="/js/config.js"></script>

    <meta name="description" content="一、概述Docker是一款针对程序开发人员和系统管理员来开发、部署、运行应用的一款虚拟化平台。Docker 可以让你像使用集装箱一样快速的组合成应用，并且可以像运输标准集装箱一样，尽可能的屏蔽代码层面的差异。Docker 会尽可能的缩短从代码测试到产品部署的时间。">
<meta property="og:type" content="article">
<meta property="og:title" content="Docker教程">
<meta property="og:url" content="https://jeremyhzf.com/2021/065b4a8a1002/index.html">
<meta property="og:site_name" content="Jeremy">
<meta property="og:description" content="一、概述Docker是一款针对程序开发人员和系统管理员来开发、部署、运行应用的一款虚拟化平台。Docker 可以让你像使用集装箱一样快速的组合成应用，并且可以像运输标准集装箱一样，尽可能的屏蔽代码层面的差异。Docker 会尽可能的缩短从代码测试到产品部署的时间。">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://jeremyhzf-blog.oss-cn-hongkong.aliyuncs.com/4f5206a75a884cc2968ceb1f6c14acb6~tplv-k3u1fbpfcp-zoom-1.png">
<meta property="og:image" content="https://jeremyhzf-blog.oss-cn-hongkong.aliyuncs.com/32ab62e6be9d4b4dbe9280ca3b9206f9~tplv-k3u1fbpfcp-zoom-1.png">
<meta property="og:image" content="https://jeremyhzf-blog.oss-cn-hongkong.aliyuncs.com/905bc296603243ad8ee09e13b651e5ba~tplv-k3u1fbpfcp-zoom-1.png">
<meta property="article:published_time" content="2021-08-28T09:46:51.000Z">
<meta property="article:modified_time" content="2021-08-28T09:46:51.000Z">
<meta property="article:author" content="Jeremyhzf">
<meta property="article:tag" content="Docker">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://jeremyhzf-blog.oss-cn-hongkong.aliyuncs.com/4f5206a75a884cc2968ceb1f6c14acb6~tplv-k3u1fbpfcp-zoom-1.png">


<link rel="canonical" href="https://jeremyhzf.com/2021/065b4a8a1002/">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"zh-CN","comments":true,"permalink":"https://jeremyhzf.com/2021/065b4a8a1002/","path":"2021/065b4a8a1002/","title":"Docker教程"}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>Docker教程 | Jeremy</title>
  






  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="headband"></div>

  <main class="main">
    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <p class="site-title">Jeremy</p>
      <i class="logo-line"></i>
    </a>
      <p class="site-subtitle" itemprop="description">分享技术与生活</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a></li><li class="menu-item menu-item-links"><a href="/links/" rel="section"><i class="fa fa-link fa-fw"></i>友链</a></li>
  </ul>
</nav>




</div>
        
  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>

  <aside class="sidebar">

    <div class="sidebar-inner sidebar-nav-active sidebar-toc-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
            <div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%B8%80%E3%80%81%E6%A6%82%E8%BF%B0"><span class="nav-text">一、概述</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BA%8C%E3%80%81%E6%9E%B6%E6%9E%84"><span class="nav-text">二、架构</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%B8%89%E3%80%81%E7%BD%91%E7%BB%9C%E6%A8%A1%E5%BC%8F"><span class="nav-text">三、网络模式</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1%E3%80%81Bridge%E6%A8%A1%E5%BC%8F"><span class="nav-text">1、Bridge模式</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2%E3%80%81host%E6%A8%A1%E5%BC%8F"><span class="nav-text">2、host模式</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3%E3%80%81none%E6%A8%A1%E5%BC%8F"><span class="nav-text">3、none模式</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4%E3%80%81Container%E6%A8%A1%E5%BC%8F"><span class="nav-text">4、Container模式</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%9B%9B%E3%80%81Docker%E5%91%BD%E4%BB%A4"><span class="nav-text">四、Docker命令</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%AE%B9%E5%99%A8%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F%E7%AE%A1%E7%90%86"><span class="nav-text">容器生命周期管理</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#1%E3%80%81run-%E5%91%BD%E4%BB%A4"><span class="nav-text">1、run 命令</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2%E3%80%81start-stop-restart-%E5%91%BD%E4%BB%A4"><span class="nav-text">2、start&#x2F;stop&#x2F;restart 命令</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3%E3%80%81kill-%E5%91%BD%E4%BB%A4"><span class="nav-text">3、kill 命令</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#4%E3%80%81rm-%E5%91%BD%E4%BB%A4"><span class="nav-text">4、rm 命令</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#5%E3%80%81pause-unpause-%E5%91%BD%E4%BB%A4"><span class="nav-text">5、pause&#x2F;unpause 命令</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#6%E3%80%81create-%E5%91%BD%E4%BB%A4"><span class="nav-text">6、create 命令</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#7%E3%80%81exec-%E5%91%BD%E4%BB%A4"><span class="nav-text">7、exec 命令</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#8%E3%80%81commit-%E5%91%BD%E4%BB%A4"><span class="nav-text">8、commit 命令</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%AE%B9%E5%99%A8%E6%93%8D%E4%BD%9C"><span class="nav-text">容器操作</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#1%E3%80%81ps-%E5%91%BD%E4%BB%A4"><span class="nav-text">1、ps 命令</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2%E3%80%81inspect-%E5%91%BD%E4%BB%A4"><span class="nav-text">2、inspect 命令</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3%E3%80%81top-%E5%91%BD%E4%BB%A4"><span class="nav-text">3、top 命令</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#4%E3%80%81attach-%E5%91%BD%E4%BB%A4"><span class="nav-text">4、attach 命令</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#5%E3%80%81events-%E5%91%BD%E4%BB%A4"><span class="nav-text">5、events 命令</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#6%E3%80%81logs-%E5%91%BD%E4%BB%A4"><span class="nav-text">6、logs 命令</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#7%E3%80%81wait-%E5%91%BD%E4%BB%A4"><span class="nav-text">7、wait 命令</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#8%E3%80%81export-%E5%91%BD%E4%BB%A4"><span class="nav-text">8、export 命令</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#9%E3%80%81import-%E5%91%BD%E4%BB%A4"><span class="nav-text">9、import 命令</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#10%E3%80%81port-%E5%91%BD%E4%BB%A4"><span class="nav-text">10、port 命令</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#11%E3%80%81stats-%E5%91%BD%E4%BB%A4"><span class="nav-text">11、stats 命令</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#12%E3%80%81cp-%E5%91%BD%E4%BB%A4"><span class="nav-text">12、cp 命令</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#13%E3%80%81diff-%E5%91%BD%E4%BB%A4"><span class="nav-text">13、diff 命令</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%95%9C%E5%83%8F%E4%BB%93%E5%BA%93"><span class="nav-text">镜像仓库</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#1%E3%80%81login-logout-%E5%91%BD%E4%BB%A4"><span class="nav-text">1、login&#x2F;logout 命令</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2%E3%80%81pull-%E5%91%BD%E4%BB%A4"><span class="nav-text">2、pull 命令</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3%E3%80%81push-%E5%91%BD%E4%BB%A4"><span class="nav-text">3、push 命令</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#4%E3%80%81search-%E5%91%BD%E4%BB%A4"><span class="nav-text">4、search 命令</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%9C%AC%E5%9C%B0%E9%95%9C%E5%83%8F%E6%93%8D%E4%BD%9C"><span class="nav-text">本地镜像操作</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#1%E3%80%81images"><span class="nav-text">1、images</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2%E3%80%81rmi-%E5%91%BD%E4%BB%A4"><span class="nav-text">2、rmi 命令</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3%E3%80%81tag-%E5%91%BD%E4%BB%A4"><span class="nav-text">3、tag 命令</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#4%E3%80%81build-%E5%91%BD%E4%BB%A4"><span class="nav-text">4、build 命令</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#5%E3%80%81history-%E5%91%BD%E4%BB%A4"><span class="nav-text">5、history 命令</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#6%E3%80%81save-%E5%91%BD%E4%BB%A4"><span class="nav-text">6、save 命令</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#7%E3%80%81load-%E5%91%BD%E4%BB%A4"><span class="nav-text">7、load 命令</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%B3%BB%E7%BB%9F%E6%93%8D%E4%BD%9C"><span class="nav-text">系统操作</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#1%E3%80%81info%E5%91%BD%E4%BB%A4"><span class="nav-text">1、info命令</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2%E3%80%81df-%E5%91%BD%E4%BB%A4"><span class="nav-text">2、df 命令</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3%E3%80%81prune-%E5%91%BD%E4%BB%A4"><span class="nav-text">3、prune 命令</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%9B%9B%E3%80%81DockerFile"><span class="nav-text">四、DockerFile</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1%E3%80%81%E6%A6%82%E8%BF%B0"><span class="nav-text">1、概述</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2%E3%80%81docker-build"><span class="nav-text">2、docker build</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#2-1%E6%9E%84%E5%BB%BA"><span class="nav-text">2.1构建</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-2-docker-build%E7%9A%84%E7%94%A8%E6%B3%95"><span class="nav-text">2.2 docker build的用法</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3%E3%80%81%E6%8C%87%E4%BB%A4"><span class="nav-text">3、指令</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#2-1-FROM"><span class="nav-text">2.1 FROM</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-2-EXPOSE"><span class="nav-text">2.2  EXPOSE</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-3-LABEL"><span class="nav-text">2.3 LABEL</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-4-ENV"><span class="nav-text">2.4 ENV</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-5-ARG"><span class="nav-text">2.5 ARG</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-6-WORKDIR"><span class="nav-text">2.6 WORKDIR</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-7-COPY"><span class="nav-text">2.7 COPY</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-8-ADD"><span class="nav-text">2.8  ADD</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-9-VOLUME"><span class="nav-text">2.9  VOLUME</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-10-RUN"><span class="nav-text">2.10 RUN</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-11-CMD"><span class="nav-text">2.11 CMD</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-12-ENTRYPOINT"><span class="nav-text">2.12 ENTRYPOINT</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-13-HEALTHCHECK"><span class="nav-text">2.13 HEALTHCHECK</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-14-USER"><span class="nav-text">2.14 USER</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-15-ONBUILD"><span class="nav-text">2.15 ONBUILD</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-DockerFile%E6%A8%A1%E7%89%88"><span class="nav-text">3. DockerFile模版</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BA%94%E3%80%81Docker-Compose"><span class="nav-text">五、Docker Compose</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1%E3%80%81%E7%AE%80%E4%BB%8B"><span class="nav-text">1、简介</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2%E3%80%81%E5%91%BD%E4%BB%A4%E8%AF%B4%E6%98%8E"><span class="nav-text">2、命令说明</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#2-1-%E5%9F%BA%E6%9C%AC%E6%A0%BC%E5%BC%8F"><span class="nav-text">2.1 基本格式</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-2-%E5%91%BD%E4%BB%A4%E9%80%89%E9%A1%B9"><span class="nav-text">2.2 命令选项</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-3-%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4"><span class="nav-text">2.3 常用命令</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3%E3%80%81%E4%BD%BF%E7%94%A8"><span class="nav-text">3、使用</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Compose-%E6%A8%A1%E6%9D%BF%E6%96%87%E4%BB%B6"><span class="nav-text">Compose 模板文件</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Docker-compose-yml%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6"><span class="nav-text">Docker-compose.yml配置文件</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%85%AD%E3%80%81etcd"><span class="nav-text">六、etcd</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%B8%80%E3%80%81ETCD%E5%8D%95%E6%9C%BA%E9%83%A8%E7%BD%B2"><span class="nav-text">一、ETCD单机部署</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#1%E3%80%81%E4%B8%8B%E8%BD%BD%E4%BA%8C%E8%BF%9B%E5%88%B6%E5%8C%85"><span class="nav-text">1、下载二进制包</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#2%E3%80%81%E8%A7%A3%E5%8E%8B%E7%BC%A9"><span class="nav-text">2、解压缩</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#3%E3%80%81%E8%AE%BE%E7%BD%AE%E7%8E%AF%E5%A2%83%E5%8F%98%E9%87%8F"><span class="nav-text">3、设置环境变量</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#4%E3%80%81%E5%90%AF%E5%8A%A8etcd"><span class="nav-text">4、启动etcd</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#5%E3%80%81%E5%AE%A2%E6%88%B7%E7%AB%AF%E6%B5%8B%E8%AF%95"><span class="nav-text">5、客户端测试</span></a></li></ol></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BA%8C%E3%80%81docker%E5%8D%95%E6%9C%BA%E9%83%A8%E7%BD%B2ETCD"><span class="nav-text">二、docker单机部署ETCD</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#1%E3%80%81%E6%8B%89%E5%8F%96etcd%E9%95%9C%E5%83%8F"><span class="nav-text">1、拉取etcd镜像</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#2%E3%80%81%E8%AE%BE%E7%BD%AE%E7%8E%AF%E5%A2%83%E5%8F%98%E9%87%8F%E5%92%8C%E7%9B%91%E5%90%AC%E5%9C%B0%E5%9D%80"><span class="nav-text">2、设置环境变量和监听地址</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#3%E3%80%81%E8%BF%90%E8%A1%8Cetcd%E5%AE%B9%E5%99%A8"><span class="nav-text">3、运行etcd容器</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#4%E3%80%81%E5%AE%A2%E6%88%B7%E7%AB%AF%E6%B5%8B%E8%AF%95"><span class="nav-text">4、客户端测试</span></a></li></ol></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%B8%89%E3%80%81Etcd%E6%9C%AC%E5%9C%B0%E9%9B%86%E7%BE%A4%EF%BC%88%E4%BD%BF%E7%94%A8goreman%E7%AE%A1%E7%90%86%EF%BC%89"><span class="nav-text">三、Etcd本地集群（使用goreman管理）</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#1%E3%80%81%E4%B8%8B%E8%BD%BDetcd%E4%BA%8C%E8%BF%9B%E5%88%B6%E5%8C%85-amp-amp-%E8%AE%BE%E7%BD%AE%E7%8E%AF%E5%A2%83%E5%8F%98%E9%87%8F-amp-amp-%E5%8F%82%E8%80%83Etcd%E5%8D%95%E6%9C%BA%E9%83%A8%E7%BD%B2"><span class="nav-text">1、下载etcd二进制包&amp;&amp;设置环境变量&amp;&amp;参考Etcd单机部署</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2%E3%80%81%E5%AE%89%E8%A3%85goreman%EF%BC%8C%E5%AE%89%E8%A3%85goreman%E5%89%8D%E9%9C%80%E8%A6%81%E5%AE%89%E8%A3%85go%E7%8E%AF%E5%A2%83%E5%92%8Cgit%E3%80%82"><span class="nav-text">2、安装goreman，安装goreman前需要安装go环境和git。</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3%E3%80%81%E5%AE%89%E8%A3%85go%E7%8E%AF%E5%A2%83"><span class="nav-text">3、安装go环境</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#4%E3%80%81%E5%AE%89%E8%A3%85git"><span class="nav-text">4、安装git</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#5%E3%80%81%E5%AE%89%E8%A3%85-goreman"><span class="nav-text">5、安装 goreman</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#6%E3%80%81%E7%BC%96%E5%86%99Procfile%EF%BC%88%E7%AE%A1%E7%90%86%E9%9B%86%E7%BE%A4%EF%BC%89"><span class="nav-text">6、编写Procfile（管理集群）</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#7%E3%80%81%E5%90%AF%E5%8A%A8etcd%EF%BC%88goreman-runlist%EF%BC%89"><span class="nav-text">7、启动etcd（goreman runlist）</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%9B%9B%E3%80%81docker-cluster%EF%BC%88%E9%9B%86%E7%BE%A4%EF%BC%89"><span class="nav-text">四、docker cluster（集群）</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#8%E3%80%81etcd%E9%9B%86%E7%BE%A4"><span class="nav-text">8、etcd集群</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#docker-netword"><span class="nav-text">docker netword</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#9%E3%80%81etcd-cluster"><span class="nav-text">9、etcd cluster</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%8F%82%E8%80%83"><span class="nav-text">参考</span></a></li></ol></div>
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author site-overview-item animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="Jeremyhzf"
      src="https://avatars.githubusercontent.com/u/49558849">
  <p class="site-author-name" itemprop="name">Jeremyhzf</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap site-overview-item animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">21</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
          <a href="/categories/">
        <span class="site-state-item-count">20</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
          <a href="/tags/">
        <span class="site-state-item-count">14</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author site-overview-item animated">
      <span class="links-of-author-item">
        <a href="https://github.com/jeremyhzf" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;jeremyhzf" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:jeremyhzf@gmail.com" title="E-Mail → mailto:jeremyhzf@gmail.com" rel="noopener" target="_blank"><i class="fa fa-envelope fa-fw"></i>E-Mail</a>
      </span>
  </div>



        </div>
      </div>
        <div class="back-to-top animated" role="button" aria-label="返回顶部">
          <i class="fa fa-arrow-up"></i>
          <span>0%</span>
        </div>
    </div>
  </aside>
  <div class="sidebar-dimmer"></div>


    </header>

    
  <div class="reading-progress-bar"></div>

  <a href="https://github.com/jeremyhzf" class="github-corner" title="Follow me on GitHub" aria-label="Follow me on GitHub" rel="noopener" target="_blank"><svg width="80" height="80" viewBox="0 0 250 250" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></a>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


    <div class="main-inner post posts-expand">


  


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://jeremyhzf.com/2021/065b4a8a1002/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="https://avatars.githubusercontent.com/u/49558849">
      <meta itemprop="name" content="Jeremyhzf">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Jeremy">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="Docker教程 | Jeremy">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          Docker教程
        </h1>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2021-08-28 17:46:51" itemprop="dateCreated datePublished" datetime="2021-08-28T17:46:51+08:00">2021-08-28</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Docker/" itemprop="url" rel="index"><span itemprop="name">Docker</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
        <h2 id="一、概述"><a href="#一、概述" class="headerlink" title="一、概述"></a>一、概述</h2><p>Docker是一款针对程序开发人员和系统管理员来开发、部署、运行应用的一款虚拟化平台。Docker 可以让你像使用集装箱一样快速的组合成应用，并且可以像运输标准集装箱一样，尽可能的屏蔽代码层面的差异。Docker 会尽可能的缩短从代码测试到产品部署的时间。</p>
<span id="more"></span>

<h2 id="二、架构"><a href="#二、架构" class="headerlink" title="二、架构"></a>二、架构</h2><p>Docker 包括三个基本概念:</p>
<ul>
<li><strong>镜像（Image）</strong>：Docker 镜像（Image），就相当于是一个 root 文件系统。镜像是<strong>无状态的、只读的</strong> 。</li>
<li><strong>容器（Container）</strong>：镜像（Image）和容器（Container）的关系，就像是面向对象程序设计中的类和实例一样，镜像是静态的定义，容器是镜像运行时的实体。容器可以被创建、启动、停止、删除、暂停等。</li>
<li><strong>仓库（Repository）</strong>：仓库可看成一个代码控制中心，用来保存镜像。</li>
</ul>
<p>使用 <code>--link</code> 参数可以让容器之间安全的进行交互。</p>
<p><code>--link</code> 参数的格式为 <code>--link name:alias</code>，其中 <code>name</code> 是要链接的容器的名称，<code>alias</code> 是这个连接的别名（可选项）。</p>
<h2 id="三、网络模式"><a href="#三、网络模式" class="headerlink" title="三、网络模式"></a>三、网络模式</h2><p>docker的网络配置分为四种, <code>host</code>、<code>Container</code>、<code>None</code>、<code>Bridge(默认)</code>。</p>
<ul>
<li><p>  Bridge：为每一个容器分配、设置 IP 等，并将容器连接到一个 <code>docker0</code> 虚拟网桥，默认为该模式</p>
</li>
<li><p>  host：容器将不会虚拟出自己的网卡，配置自己的 IP 等，而是使用宿主机的 IP 和端口。</p>
</li>
<li><p>  Container：新创建的容器不会创建自己的网卡和配置自己的 IP，而是和一个指定的容器共享 IP、端口范围等。</p>
</li>
<li><p>  None： 容器有独立的 Network namespace，但并没有对其进行任何网络设置，如分配 veth pair 和网桥连接，IP 等。</p>
</li>
</ul>
<p>查看所有网络模式：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">docker network <span class="built_in">ls</span></span></span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">docker network inspect bridge      <span class="comment"># 查看bridge 有哪些正在运行的容器</span></span></span><br></pre></td></tr></table></figure>



<h3 id="1、Bridge模式"><a href="#1、Bridge模式" class="headerlink" title="1、Bridge模式"></a>1、Bridge模式</h3><p><img data-src="https://jeremyhzf-blog.oss-cn-hongkong.aliyuncs.com/4f5206a75a884cc2968ceb1f6c14acb6~tplv-k3u1fbpfcp-zoom-1.png" alt="img"></p>
<p>在该模式中，Docker 守护进程创建了一个虚拟以太网桥 <code>docker0</code>，新建的容器会自动桥接到这个接口，附加在其上的任何网卡之间都能自动转发数据包。</p>
<p>简单来说，这个模式容器通过docker0连接外网，外部需要通过映射端口连接容器，容器之前通过docker0访问。</p>
<p>缺点：docker0随机分配IP，容器IP不固定。</p>
<h3 id="2、host模式"><a href="#2、host模式" class="headerlink" title="2、host模式"></a>2、host模式</h3><p><img data-src="https://jeremyhzf-blog.oss-cn-hongkong.aliyuncs.com/32ab62e6be9d4b4dbe9280ca3b9206f9~tplv-k3u1fbpfcp-zoom-1.png" alt="img"></p>
<p>采用 host 网络模式的 Docker Container，可以直接使用<strong>宿主机的 IP 地址</strong>与外界进行通信，若宿主机的 eth0 是一个公有 IP，那么容器也拥有这个公有 IP。同时容器内服务的端口也可以使用宿主机的端口，无需额外进行 NAT 转换；</p>
<p>host 网络模式可以让容器共享宿主机网络栈，这样的好处是外部主机与容器直接通信，但是容器的网络缺少隔离性，安全性降低。且会出现端口冲突，这个模式使用较少。</p>
<h3 id="3、none模式"><a href="#3、none模式" class="headerlink" title="3、none模式"></a>3、none模式</h3><p>none 网络模式是指禁用网络功能，只有 lo 接口 local 的简写，代表 127.0.0.1，即 localhost 本地环回接口。在创建容器时通过参数 <code>--net none</code> 或者 <code>--network none</code> 指定；</p>
<p>简单来说就是这个容器不联网。</p>
<h3 id="4、Container模式"><a href="#4、Container模式" class="headerlink" title="4、Container模式"></a>4、Container模式</h3><p><img data-src="https://jeremyhzf-blog.oss-cn-hongkong.aliyuncs.com/905bc296603243ad8ee09e13b651e5ba~tplv-k3u1fbpfcp-zoom-1.png" alt="img"></p>
<p><strong>Container 网络模式即新创建的容器不会创建自己的网卡，配置自己的 IP，而是和一个指定的容器共享 IP、端口范围等</strong>。</p>
<p>Docker 容器会共享一个网络栈，这样两个容器之间可以使用 localhost 高效快速通信。</p>
<blockquote>
<p>  参考： <a target="_blank" rel="noopener" href="https://www.cnblogs.com/mrhelloworld/p/docker11.html">https://www.cnblogs.com/mrhelloworld/p/docker11.html</a></p>
</blockquote>
<h2 id="四、Docker命令"><a href="#四、Docker命令" class="headerlink" title="四、Docker命令"></a>四、Docker命令</h2><h3 id="容器生命周期管理"><a href="#容器生命周期管理" class="headerlink" title="容器生命周期管理"></a>容器生命周期管理</h3><h4 id="1、run-命令"><a href="#1、run-命令" class="headerlink" title="1、run 命令"></a>1、run 命令</h4><p>创建一个新的容器并运行一个命令</p>
<p><strong>语法:</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">docker run [OPTIONS] IMAGE [COMMAND] [ARG...]</span></span><br></pre></td></tr></table></figure>

<p>OPTIONS说明：</p>
<ul>
<li>  <strong>-a stdin:</strong> 指定标准输入输出内容类型，可选 STDIN/STDOUT/STDERR 三项；</li>
<li>  <strong>-d:</strong> 后台运行容器，并返回容器ID；</li>
<li>  <strong>-i:</strong> 以交互模式运行容器，通常与 -t 同时使用；</li>
<li>  <strong>-P:</strong> 随机端口映射，容器内部端口<strong>随机</strong>映射到主机的端口</li>
<li>  <strong>-p:</strong> 指定端口映射，格式为：<strong>主机(宿主)端口:容器端口</strong></li>
<li>  <strong>-t:</strong> 为容器重新分配一个伪输入终端，通常与 -i 同时使用；</li>
<li>  <strong>–name=”nginx-lb”:</strong> 为容器指定一个名称；</li>
<li>  <strong>–dns 8.8.8.8:</strong> 指定容器使用的DNS服务器，默认和宿主一致；</li>
<li>  <strong>–dns-search example.com:</strong> 指定容器DNS搜索域名，默认和宿主一致；</li>
<li>  <strong>-h “mars”:</strong> 指定容器的hostname；</li>
<li>  <strong>-e username=”ritchie”:</strong> 设置环境变量；</li>
<li>  <strong>–env-file=[]:</strong> 从指定文件读入环境变量；</li>
<li>  <strong>–cpuset=”0-2” or –cpuset=”0,1,2”:</strong> 绑定容器到指定CPU运行；</li>
<li>  **-m :**设置容器使用内存最大值；</li>
<li>  <strong>–net=”bridge”:</strong> 指定容器的网络连接类型，支持 bridge/host/none/container: 四种类型；</li>
<li>  <strong>–link=[]:</strong> 添加链接到另一个容器，可以让容器之间安全的进行交互。；</li>
<li>  <strong>–expose=[]:</strong> 开放一个端口或一组端口；</li>
<li>  <strong>–volume , -v:</strong> 绑定一个卷</li>
</ul>
<p><strong>实例：</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">运行一个wordpress容器</span></span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">docker run -p 8080:80 --name wordpress \                   <span class="comment"># 映射端口 本机端口:容器端口</span></span> </span><br><span class="line">-v /Users/zhengfa.hu/Docker/wordpress:/var/www/html \        # 绑定本机卷</span><br><span class="line">-e WORDPRESS_DB_PASSWORD=root \                              # 设置环境变量</span><br><span class="line">-e WORDPRESS_DB_HOST=mysql:3306 \                            # 设置环境变量</span><br><span class="line">--link mysql \                                               # 连接到mysql容器</span><br><span class="line">-d wordpress                                                 # -d 后台运行，镜像:&lt;版本&gt;</span><br></pre></td></tr></table></figure>

<h4 id="2、start-stop-restart-命令"><a href="#2、start-stop-restart-命令" class="headerlink" title="2、start/stop/restart 命令"></a>2、start/stop/restart 命令</h4><p>启动/停止/重启一个或多个容器。</p>
<p>实例：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">docker start $(docker ps -a | awk <span class="string">&#x27;&#123; print $1&#125;&#x27;</span> | <span class="built_in">tail</span> -n +2)     <span class="comment"># docker 启动所有的容器</span></span></span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">docker stop $(docker ps -a | awk <span class="string">&#x27;&#123; print $1&#125;&#x27;</span> | <span class="built_in">tail</span> -n +2)      <span class="comment"># docker 关闭所有的容器</span></span></span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">docker stop $(docker ps | awk <span class="string">&#x27;&#123; print $1&#125;&#x27;</span> | <span class="built_in">tail</span> -n +2)         <span class="comment"># 暂停所有正在运行的容器</span></span></span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">docker restart $(docker ps | awk <span class="string">&#x27;&#123; print $1&#125;&#x27;</span> | <span class="built_in">tail</span> -n +2)      <span class="comment"># 重启所有正在运行的容器</span></span></span><br></pre></td></tr></table></figure>

<h4 id="3、kill-命令"><a href="#3、kill-命令" class="headerlink" title="3、kill 命令"></a>3、kill 命令</h4><p>杀掉一个运行中的容器。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker kill [OPTIONS] CONTAINER [CONTAINER...]</span><br></pre></td></tr></table></figure>

<p>OPTIONS说明：</p>
<ul>
<li>  **-s :**向容器发送一个信号</li>
</ul>
<p>实例：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">docker <span class="built_in">kill</span> -s KILL nginx</span></span><br></pre></td></tr></table></figure>

<h4 id="4、rm-命令"><a href="#4、rm-命令" class="headerlink" title="4、rm 命令"></a>4、rm 命令</h4><p>删除一个或多个容器。</p>
<p><strong>语法：</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">docker <span class="built_in">rm</span> [OPTIONS] CONTAINER [CONTAINER...]</span></span><br></pre></td></tr></table></figure>

<p>OPTIONS说明：</p>
<ul>
<li>  **-f :**通过 SIGKILL 信号强制删除一个运行中的容器。</li>
<li>  **-l :**移除容器间的网络连接，而非容器本身。</li>
<li>  **-v :**删除与容器关联的卷，容器也会删除。</li>
</ul>
<p><strong>实例：</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">docker <span class="built_in">rm</span> $(docker ps -a | awk <span class="string">&#x27;&#123; print $1&#125;&#x27;</span> | <span class="built_in">tail</span> -n +2)   <span class="comment"># docker 删除所有的容器</span></span></span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">docker rmi $(docker images | awk <span class="string">&#x27;&#123;print $3&#125;&#x27;</span> |<span class="built_in">tail</span> -n +2)   <span class="comment"># docker 删除所有的镜像</span></span></span><br></pre></td></tr></table></figure>

<h4 id="5、pause-unpause-命令"><a href="#5、pause-unpause-命令" class="headerlink" title="5、pause/unpause 命令"></a>5、pause/unpause 命令</h4><p><strong>docker pause</strong> :暂停容器中所有的进程。</p>
<p><strong>docker unpause</strong> :恢复容器中所有的进程。</p>
<p><strong>语法：</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">docker pause CONTAINER [CONTAINER...]</span></span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">docker unpause CONTAINER [CONTAINER...]</span></span><br></pre></td></tr></table></figure>

<p><strong>实例：</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">docker pause nginx            <span class="comment"># 暂停容器nginx提供服务</span></span></span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">docker unpause nginx          <span class="comment"># 恢复容器nginx提供服务</span></span></span><br></pre></td></tr></table></figure>

<h4 id="6、create-命令"><a href="#6、create-命令" class="headerlink" title="6、create 命令"></a>6、create 命令</h4><p>创建一个新的容器但不启动它。用法同 [docker run](#1、run 命令) 。</p>
<h4 id="7、exec-命令"><a href="#7、exec-命令" class="headerlink" title="7、exec 命令"></a>7、exec 命令</h4><p>在运行的容器中执行命令</p>
<p><strong>语法：</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker exec [OPTIONS] CONTAINER COMMAND [ARG...]</span><br></pre></td></tr></table></figure>

<p>OPTIONS说明：</p>
<ul>
<li>  **-d :**分离模式: 在后台运行</li>
<li>  **-i :**即使没有附加也保持STDIN 打开</li>
<li>  **-t :**分配一个伪终端</li>
</ul>
<p><strong>实例：</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">docker <span class="built_in">exec</span> -it &lt;容器ID或者容器name&gt; /bin/bash      <span class="comment"># 进入容器</span></span></span><br></pre></td></tr></table></figure>

<h4 id="8、commit-命令"><a href="#8、commit-命令" class="headerlink" title="8、commit 命令"></a>8、commit 命令</h4><p>从容器创建一个新的镜像。</p>
<p><strong>语法：</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker commit [OPTIONS] CONTAINER [REPOSITORY[:TAG]]</span><br></pre></td></tr></table></figure>

<p>OPTIONS说明：</p>
<ul>
<li>  **-a :**提交的镜像作者；</li>
<li>  **-c :**使用Dockerfile指令来创建镜像；</li>
<li>  **-m :**提交时的说明文字；</li>
<li>  **-p :**在commit时，将容器暂停。</li>
</ul>
<p><strong>实例：</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">docker commit -a <span class="string">&quot;runoob.com&quot;</span> -m <span class="string">&quot;my apache&quot;</span> mysql  mysql:v1    <span class="comment"># 将容器mysql 保存为新的镜像</span></span></span><br></pre></td></tr></table></figure>

<h3 id="容器操作"><a href="#容器操作" class="headerlink" title="容器操作"></a>容器操作</h3><h4 id="1、ps-命令"><a href="#1、ps-命令" class="headerlink" title="1、ps 命令"></a>1、ps 命令</h4><p>列出容器</p>
<p><strong>语法：</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker ps [OPTIONS]</span><br></pre></td></tr></table></figure>

<p>OPTIONS说明：</p>
<ul>
<li>  **-a :**显示所有的容器，包括未运行的。</li>
<li>  **-f :**根据条件过滤显示的内容。</li>
<li>  **–format :**指定返回值的模板文件。</li>
<li>  **-l :**显示最近创建的容器。</li>
<li>  **-n :**列出最近创建的n个容器。</li>
<li>  **–no-trunc :**不截断输出。</li>
<li>  **-q :**静默模式，只显示容器编号。</li>
<li>  **-s :**显示总的文件大小。</li>
</ul>
<p>输出：</p>
<p>容器ID、镜像、启动容器时运行的命令、容器创建时间、容器状态、端口信息、容器名称</p>
<p>容器状态（七种）：</p>
<p>created已创建、restarting重启中、running运行中、removing迁移中、paused暂停、exited停止、dead死亡</p>
<p><strong>实例：</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">docker ps -f <span class="string">&quot;name=nginx&quot;</span>             <span class="comment"># 根据名称过滤</span></span></span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">docker ps -f status=running           <span class="comment"># 根据容器状态过滤</span></span></span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">docker ps --filter ancestor=nginx     <span class="comment"># 根据镜像名称过滤</span></span></span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">docker ps --filter ancestor=&lt;ID&gt;      <span class="comment"># 根据容器ID过滤</span></span></span><br></pre></td></tr></table></figure>

<h4 id="2、inspect-命令"><a href="#2、inspect-命令" class="headerlink" title="2、inspect 命令"></a>2、inspect 命令</h4><p>获取容器/镜像的元数据。</p>
<p><strong>语法：</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker inspect [OPTIONS] NAME|ID [NAME|ID...]</span><br></pre></td></tr></table></figure>

<p>OPTIONS说明：</p>
<ul>
<li>  **-f :**指定返回值的模板文件。</li>
<li>  **-s :**显示总的文件大小。</li>
<li>  **–type :**为指定类型返回JSON。</li>
</ul>
<p><strong>实例：</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">获取容器元数据，默认输出格式为JSON  --format 过滤输出ip</span></span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">docker inspect --format=<span class="string">&#x27;&#123;&#123;range .NetworkSettings.Networks&#125;&#125;&#123;&#123;.IPAddress&#125;&#125;&#123;&#123;end&#125;&#125;&#x27;</span> mysql</span></span><br></pre></td></tr></table></figure>

<h4 id="3、top-命令"><a href="#3、top-命令" class="headerlink" title="3、top 命令"></a>3、top 命令</h4><p>查看容器中运行的进程信息，支持 ps 命令参数。</p>
<p><strong>语法：</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker top [OPTIONS] CONTAINER [ps OPTIONS]</span><br></pre></td></tr></table></figure>

<p>参数支持<code>docker ps</code>。</p>
<p><strong>实例：</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">docker top mysql</span></span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">docker top ea59b5ae9693</span></span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash"><span class="keyword">for</span> i <span class="keyword">in</span>  `docker ps |grep Up|awk <span class="string">&#x27;&#123;print $1&#125;&#x27;</span>`;<span class="keyword">do</span> <span class="built_in">echo</span> \ &amp;&amp;docker top <span class="variable">$i</span>; <span class="keyword">done</span></span></span><br></pre></td></tr></table></figure>

<h4 id="4、attach-命令"><a href="#4、attach-命令" class="headerlink" title="4、attach 命令"></a>4、attach 命令</h4><p>连接到正在运行中的容器。一般用不着，可以使用<code>exec</code> 。</p>
<h4 id="5、events-命令"><a href="#5、events-命令" class="headerlink" title="5、events 命令"></a>5、events 命令</h4><p>从服务器获取实时事件。</p>
<p><strong>语法：</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker events [OPTIONS]</span><br></pre></td></tr></table></figure>

<p>OPTIONS说明：</p>
<ul>
<li>  <strong>-f ：</strong>根据条件过滤事件；</li>
<li>  <strong>–since ：</strong>从指定的时间戳后显示所有事件;</li>
<li>  <strong>–until ：</strong>流水时间显示到指定的时间为止；</li>
</ul>
<p><strong>实例：</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">docker events  --since=<span class="string">&quot;1467302400&quot;</span></span>            </span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">docker events -f <span class="string">&quot;image&quot;</span>=<span class="string">&quot;mysql:5.6&quot;</span> --since=<span class="string">&quot;1467302400&quot;</span>  <span class="comment"># 显示mysql镜像相关的事件</span></span></span><br></pre></td></tr></table></figure>

<h4 id="6、logs-命令"><a href="#6、logs-命令" class="headerlink" title="6、logs 命令"></a>6、logs 命令</h4><p>获取容器的日志。</p>
<p><strong>语法：</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker logs [OPTIONS] CONTAINER</span><br></pre></td></tr></table></figure>

<p>OPTIONS说明：</p>
<ul>
<li>  <strong>-f :</strong> 跟踪日志输出</li>
<li>  **–since :**显示某个开始时间的所有日志</li>
<li>  <strong>-t :</strong> 显示时间戳</li>
<li>  **–tail :**仅列出最新N条容器日志</li>
</ul>
<p><strong>实例：</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">docker logs -f mysql</span></span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">docker logs --since=<span class="string">&quot;2016-07-01&quot;</span> --<span class="built_in">tail</span>=10 mysql</span></span><br></pre></td></tr></table></figure>

<h4 id="7、wait-命令"><a href="#7、wait-命令" class="headerlink" title="7、wait 命令"></a>7、wait 命令</h4><p>阻塞运行直到容器停止，然后打印出它的退出代码。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">docker <span class="built_in">wait</span> mysql</span></span><br></pre></td></tr></table></figure>

<h4 id="8、export-命令"><a href="#8、export-命令" class="headerlink" title="8、export 命令"></a>8、export 命令</h4><p>将文件系统作为一个tar归档文件导出到STDOUT。导出的是一个容器的快照。</p>
<p><strong>语法：</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker export [OPTIONS] CONTAINER</span><br></pre></td></tr></table></figure>

<p>OPTIONS说明：</p>
<ul>
<li>  **-o :**将输入内容写到文件。</li>
</ul>
<p><strong>实例：</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">docker <span class="built_in">export</span> -o mysql-`<span class="built_in">date</span> +%Y%m%d`.tar a404c6c174a2  <span class="comment"># 将容器按日期保存为tar文件</span></span></span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash"><span class="built_in">ls</span> mysql-`<span class="built_in">date</span> +%Y%m%d`.tar</span></span><br><span class="line">mysql-20160711.tar</span><br></pre></td></tr></table></figure>

<h4 id="9、import-命令"><a href="#9、import-命令" class="headerlink" title="9、import 命令"></a>9、import 命令</h4><p>从归档文件来载入容器包，但会恢复为镜像。</p>
<p><strong>语法：</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker import [OPTIONS] file|URL|- [REPOSITORY[:TAG]]</span><br></pre></td></tr></table></figure>

<p>OPTIONS说明：</p>
<ul>
<li>  **-c :**应用docker 指令创建镜像；</li>
<li>  **-m :**提交时的说明文字；</li>
</ul>
<p><strong>实例：</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">docker import  my_ubuntu_v3.tar runoob/ubuntu:v4</span>  </span><br></pre></td></tr></table></figure>

<blockquote>
<p>  export 和 import 导出的是一个容器的快照, 不是镜像本身, 也就是说没有 layer。</p>
<p>  你的 dockerfile 里的 workdir, entrypoint 之类的所有东西都会丢失，commit 过的话也会丢失。</p>
<p>  快照文件将丢弃所有的历史记录和元数据信息（即仅保存容器当时的快照状态），而镜像存储文件将保存完整记录，体积也更大。</p>
</blockquote>
<h4 id="10、port-命令"><a href="#10、port-命令" class="headerlink" title="10、port 命令"></a>10、port 命令</h4><p>列出指定的容器的端口映射，或者查找将PRIVATE_PORT NAT到面向公众的端口。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">docker port mysql             <span class="comment"># 查看容器的端口映射情况</span></span></span><br></pre></td></tr></table></figure>

<h4 id="11、stats-命令"><a href="#11、stats-命令" class="headerlink" title="11、stats 命令"></a>11、stats 命令</h4><p>显示容器资源的使用情况，包括：CPU、内存、网络 I/O 等。</p>
<p><strong>语法：</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker stats [OPTIONS] [CONTAINER...]</span><br></pre></td></tr></table></figure>

<p>OPTIONS 说明：</p>
<ul>
<li>  **–all , -a :**显示所有的容器，包括未运行的。</li>
<li>  **–format :**指定返回值的模板文件。</li>
<li>  **–no-stream :**展示当前状态就直接退出了，不再实时更新。</li>
<li>  **–no-trunc :**不截断输出。</li>
</ul>
<p>输出：</p>
<p>容器ID、容器name、CPU使用率、容器内存使用信息、内存使用率、网络IO发送/接收、容器-本机数据读取和写入数据量、容器创建的进程或线程数</p>
<p><strong>实例：</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">docker stats mysql</span></span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">docker stats &lt;ID&gt;</span></span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">docker stats mysql --no-stream --format <span class="string">&quot;&#123;&#123; json . &#125;&#125;&quot;</span>    <span class="comment"># 以JSON格式输出</span></span></span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">docker stats --all --no-stream --format <span class="string">&quot;table &#123;&#123;.Container&#125;&#125;\t&#123;&#123;.CPUPerc&#125;&#125;\t&#123;&#123;.MemUsage&#125;&#125;&quot;</span> mysql wordpress</span></span><br></pre></td></tr></table></figure>

<h4 id="12、cp-命令"><a href="#12、cp-命令" class="headerlink" title="12、cp 命令"></a>12、cp 命令</h4><p>用于容器与主机之间的数据拷贝。</p>
<p><strong>语法：</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">docker cp [OPTIONS]  CONTAINER:SRC_PATH   DEST_PATH  </span><br><span class="line">docker cp [OPTIONS]  SRC_PATH   CONTAINER:DEST_PATH</span><br></pre></td></tr></table></figure>

<p>OPTIONS说明：</p>
<ul>
<li>  **-L :**保持源目标中的链接</li>
</ul>
<p><strong>实例：</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">将本机 ndnav 文件夹，拷贝到容器 themes/ 文件夹下</span></span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">docker <span class="built_in">cp</span> /Downloads/ndnav wordpress:/var/www/html/wp-content/themes/</span> </span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">将本机 ndnav 文件夹，拷贝到容器中并重命名为 ndnav-v1</span></span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">docker <span class="built_in">cp</span> /Downloads/ndnav wordpress:/var/www/html/wp-content/themes/ndnav-v1</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">将容器 themes 目录下的文件拷贝到主机的Downloads/目录下中。</span></span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">docker <span class="built_in">cp</span> wordpress:/var/www/html/wp-content/themes/ /Downloads/</span> </span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash"><span class="built_in">cd</span> /Downloads/themes/</span></span><br></pre></td></tr></table></figure>

<h4 id="13、diff-命令"><a href="#13、diff-命令" class="headerlink" title="13、diff 命令"></a>13、diff 命令</h4><p>检查容器里文件结构的更改。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">docker diff mysql       <span class="comment"># 查看容器mysql的文件结构更改</span></span></span><br></pre></td></tr></table></figure>

<h3 id="镜像仓库"><a href="#镜像仓库" class="headerlink" title="镜像仓库"></a>镜像仓库</h3><h4 id="1、login-logout-命令"><a href="#1、login-logout-命令" class="headerlink" title="1、login/logout 命令"></a>1、login/logout 命令</h4><p>登陆和登出Docker镜像仓库。如果未指定镜像仓库地址，默认是Docker Hub。</p>
<p><strong>语法：</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">docker login [OPTIONS] [SERVER]</span><br><span class="line">docker logout [OPTIONS] [SERVER]</span><br></pre></td></tr></table></figure>

<p>OPTIONS说明：</p>
<ul>
<li>  **-u :**登陆的用户名</li>
<li>  **-p :**登陆的密码</li>
</ul>
<p><strong>实例：</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">docker login -u 用户名 -p 密码 &lt;server&gt;           <span class="comment"># 登陆指定的镜像仓库</span></span></span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">docker login -u 用户名 -p 密码</span></span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">docker <span class="built_in">logout</span></span></span><br></pre></td></tr></table></figure>

<h4 id="2、pull-命令"><a href="#2、pull-命令" class="headerlink" title="2、pull 命令"></a>2、pull 命令</h4><p>从镜像仓库中拉取或者更新指定镜像。</p>
<p><strong>语法：</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker pull [OPTIONS] NAME[:TAG|@DIGEST]</span><br></pre></td></tr></table></figure>

<p>OPTIONS说明：</p>
<ul>
<li>  **-a :**拉取所有 tagged 镜像</li>
<li>  **–disable-content-trust :**忽略镜像的校验,默认开启</li>
</ul>
<p><strong>实例：</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">docker pull mysql:5.7</span></span><br></pre></td></tr></table></figure>

<h4 id="3、push-命令"><a href="#3、push-命令" class="headerlink" title="3、push 命令"></a>3、push 命令</h4><p>将本地的镜像上传到镜像仓库,要先登陆到镜像仓库。</p>
<p><strong>语法：</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker push [OPTIONS] NAME[:TAG]</span><br></pre></td></tr></table></figure>

<p>OPTIONS说明：</p>
<ul>
<li>  **–disable-content-trust :**忽略镜像的校验,默认开启</li>
</ul>
<p><strong>实例：</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">docker push mysql:5.7</span></span><br></pre></td></tr></table></figure>

<h4 id="4、search-命令"><a href="#4、search-命令" class="headerlink" title="4、search 命令"></a>4、search 命令</h4><p>从Docker Hub查找镜像</p>
<p><strong>语法：</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker search [OPTIONS] TERM</span><br></pre></td></tr></table></figure>

<p>OPTIONS说明：</p>
<ul>
<li>  **–automated :**只列出 automated build类型的镜像；</li>
<li>  **–no-trunc :**显示完整的镜像描述；</li>
<li>  **-f &lt;过滤条件&gt;:**列出收藏数不小于指定值的镜像。</li>
</ul>
<p>参数：</p>
<p>NAME、DESCRIPTION描述、STARS、OFFICIAL是否是官方发布、AUTOMATED自动构建</p>
<p><strong>实例：</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">docker search -f stars=10 java   <span class="comment"># 从Docker Hub查找所有镜像名包含 java，并且收藏数大于 10 的镜像</span></span></span><br></pre></td></tr></table></figure>

<h3 id="本地镜像操作"><a href="#本地镜像操作" class="headerlink" title="本地镜像操作"></a>本地镜像操作</h3><h4 id="1、images"><a href="#1、images" class="headerlink" title="1、images"></a>1、images</h4><p>列出本地镜像。</p>
<p><strong>语法：</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker images [OPTIONS] [REPOSITORY[:TAG]]</span><br></pre></td></tr></table></figure>

<p>OPTIONS说明：</p>
<ul>
<li>  **-a :**列出本地所有的镜像（含中间映像层，默认情况下，过滤掉中间映像层）；</li>
<li>  **–digests :**显示镜像的摘要信息；</li>
<li>  **-f :**显示满足条件的镜像；</li>
<li>  **–format :**指定返回值的模板文件；</li>
<li>  **–no-trunc :**显示完整的镜像信息；</li>
<li>  **-q :**只显示镜像ID。</li>
</ul>
<p><strong>实例：</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">docker images mysql           <span class="comment"># 查看mysql的本地镜像</span></span></span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">docker images                 <span class="comment"># 查看所有本地镜像</span></span></span><br></pre></td></tr></table></figure>

<h4 id="2、rmi-命令"><a href="#2、rmi-命令" class="headerlink" title="2、rmi 命令"></a>2、rmi 命令</h4><p>删除本地一个或多个镜像。</p>
<p><strong>语法：</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker rmi [OPTIONS] IMAGE [IMAGE...]</span><br></pre></td></tr></table></figure>

<p>OPTIONS说明：</p>
<ul>
<li>  **-f :**强制删除；</li>
<li>  **–no-prune :**不移除该镜像的过程镜像，默认移除；</li>
</ul>
<p><strong>实例：</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">docker rmi -f mysql      <span class="comment"># 强制移除本地mysql镜像</span></span></span><br></pre></td></tr></table></figure>

<h4 id="3、tag-命令"><a href="#3、tag-命令" class="headerlink" title="3、tag 命令"></a>3、tag 命令</h4><p>用于给镜像打标签。不会产生新的镜像。</p>
<blockquote>
<p>  tag 打标签就是多了一个引用，镜像ID相同，所以删除的时候不能用ID去删除，需要按照Tag去删除引用。</p>
</blockquote>
<p><strong>语法：</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker tag [OPTIONS] IMAGE[:TAG] [REGISTRYHOST/][USERNAME/]NAME[:TAG]</span><br></pre></td></tr></table></figure>

<p><strong>实例：</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">docker tag nginx:latest  nginx:v1       <span class="comment"># TAG 标签v1</span></span></span><br></pre></td></tr></table></figure>

<h4 id="4、build-命令"><a href="#4、build-命令" class="headerlink" title="4、build 命令"></a>4、build 命令</h4><p>命令用于使用 Dockerfile 创建镜像。</p>
<p><strong>语法：</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker build [OPTIONS] PATH | URL | -</span><br></pre></td></tr></table></figure>

<p>OPTIONS说明：</p>
<ul>
<li>  **–build-arg=[] :**设置镜像创建时的变量；</li>
<li>  **–cpu-shares :**设置 cpu 使用权重；</li>
<li>  **–cpu-period :**限制 CPU CFS周期；</li>
<li>  **–cpu-quota :**限制 CPU CFS配额；</li>
<li>  **–cpuset-cpus :**指定使用的CPU id；</li>
<li>  **–cpuset-mems :**指定使用的内存 id；</li>
<li>  **–disable-content-trust :**忽略校验，默认开启；</li>
<li>  **-f :**指定要使用的Dockerfile路径；</li>
<li>  **–force-rm :**设置镜像过程中删除中间容器；</li>
<li>  **–isolation :**使用容器隔离技术；</li>
<li>  **–label=[] :**设置镜像使用的元数据；</li>
<li>  **-m :**设置内存最大值；</li>
<li>  **–memory-swap :**设置Swap的最大值为内存+swap，”-1”表示不限swap；</li>
<li>  **–no-cache :**创建镜像的过程不使用缓存；</li>
<li>  **–pull :**尝试去更新镜像的新版本；</li>
<li>  **–quiet, -q :**安静模式，成功后只输出镜像 ID；</li>
<li>  **–rm :**设置镜像成功后删除中间容器；</li>
<li>  **–shm-size :**设置/dev/shm的大小，默认值是64M；</li>
<li>  **–ulimit :**Ulimit配置。</li>
<li>  **–squash :**将 Dockerfile 中所有的操作压缩为一层。</li>
<li>  <strong>–tag, -t:</strong> 镜像的名字及标签，通常 name:tag 或者 name 格式；可以在一次构建中为一个镜像设置多个标签。</li>
<li>  <strong>–network:</strong> 默认 default。在构建期间设置RUN指令的网络模式</li>
</ul>
<p><strong>实例：</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">docker build -t runoob/ubuntu:v1 .          <span class="comment"># 使用当前目录的 Dockerfile 创建镜像，注意 .  符号</span></span></span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">docker build github.com/creack/docker-firefox    <span class="comment"># 使用远程Dockerfile 文件创建镜像</span></span></span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">docker build -f /path/to/a/Dockerfile .          <span class="comment"># -f 指定Dockerfile 的位置</span></span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>  在 Docker 守护进程执行 Dockerfile 中的指令前，首先会对 Dockerfile 进行语法检查，有语法错误时会返回</p>
</blockquote>
<h4 id="5、history-命令"><a href="#5、history-命令" class="headerlink" title="5、history 命令"></a>5、history 命令</h4><p>查看指定镜像的创建历史。</p>
<p><strong>语法：</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker history [OPTIONS] IMAGE</span><br></pre></td></tr></table></figure>

<p>OPTIONS说明：</p>
<ul>
<li>  **-H :**以可读的格式打印镜像大小和日期，默认为true；</li>
<li>  **–no-trunc :**显示完整的提交记录；</li>
<li>  **-q :**仅列出提交记录ID。</li>
</ul>
<p><strong>实例：</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">docker <span class="built_in">history</span> mysql:5.6</span></span><br></pre></td></tr></table></figure>

<h4 id="6、save-命令"><a href="#6、save-命令" class="headerlink" title="6、save 命令"></a>6、save 命令</h4><p>将指定镜像保存成 tar 归档文件。</p>
<p><strong>语法：</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker save [OPTIONS] IMAGE [IMAGE...]</span><br></pre></td></tr></table></figure>

<p>OPTIONS 说明：</p>
<ul>
<li>  **-o :**输出到的文件。</li>
</ul>
<p><strong>实例：</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">将镜像 runoob/ubuntu:v3 生成 my_ubuntu_v3.tar</span> </span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">docker save -o my_ubuntu_v3.tar runoob/ubuntu:v3</span></span><br></pre></td></tr></table></figure>

<h4 id="7、load-命令"><a href="#7、load-命令" class="headerlink" title="7、load 命令"></a>7、load 命令</h4><p>导入使用 <code>docker save</code> 命令导出的镜像。</p>
<p><strong>语法：</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker load [OPTIONS]</span><br></pre></td></tr></table></figure>

<p>OPTIONS 说明：</p>
<ul>
<li>  <strong>–input , -i :</strong> 指定导入的文件，代替 STDIN。</li>
<li>  <strong>–quiet , -q :</strong> 精简输出信息。</li>
</ul>
<p><strong>实例：</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">docker load &lt; busybox.tar.gz</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>  save 和 load 命令作用对象是镜像，export 和 import 命令作用对象是容器。</p>
</blockquote>
<h3 id="系统操作"><a href="#系统操作" class="headerlink" title="系统操作"></a>系统操作</h3><blockquote>
<p>  docker system [cmd]</p>
</blockquote>
<h4 id="1、info命令"><a href="#1、info命令" class="headerlink" title="1、info命令"></a>1、info命令</h4><p>显示 Docker 系统信息，包括镜像和容器数。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">docker system info</span></span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">docker system info --format    <span class="comment"># 定义输出格式</span></span></span><br></pre></td></tr></table></figure>

<h4 id="2、df-命令"><a href="#2、df-命令" class="headerlink" title="2、df 命令"></a>2、df 命令</h4><p>整体磁盘的使用情况.</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">docker system <span class="built_in">df</span></span></span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">docker system <span class="built_in">df</span> -v        <span class="comment"># 显示详细信息</span></span></span><br></pre></td></tr></table></figure>

<h4 id="3、prune-命令"><a href="#3、prune-命令" class="headerlink" title="3、prune 命令"></a>3、prune 命令</h4><p>清理没有使用的数据，包括镜像数据，已经停止的容器。<strong>操作需谨慎</strong>。</p>
<p>语法：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker system prune</span><br></pre></td></tr></table></figure>

<p>OPTIONS 说明：</p>
<ul>
<li>  <strong>–all</strong>  :删除所有未使用的图像，而不仅仅是悬垂的图像。</li>
<li>  <strong>–filter  :</strong> 筛选(e.g. ‘label=<key>=<value>‘)。</li>
<li>  <strong>–force，-f ：</strong> 不提示确认，强制删除。</li>
<li>  <strong>–volumes：</strong>  删除卷。</li>
</ul>
<p><strong>实例：</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">docker system prune         <span class="comment"># 一次性清理多种类型的资源</span></span></span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">docker image prune          <span class="comment"># 删除所有未被 tag 标记和未被容器使用的镜像</span></span></span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">docker image prune -a       <span class="comment"># 删除所有未被容器使用的镜像</span></span></span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">docker container prune      <span class="comment"># 删除所有停止运行的容器</span></span></span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">docker volume prune         <span class="comment"># 删除所有未被挂载的卷</span></span></span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">docker network prune        <span class="comment"># 删除 docker 所有资源</span></span></span><br></pre></td></tr></table></figure>

<h2 id="四、DockerFile"><a href="#四、DockerFile" class="headerlink" title="四、DockerFile"></a>四、DockerFile</h2><h3 id="1、概述"><a href="#1、概述" class="headerlink" title="1、概述"></a>1、概述</h3><p>Dockerfile 是一个用来构建镜像的文本文件，文本内容包含了一条条构建镜像所需的指令和说明。</p>
<p>Dockerfile 分为四部分：</p>
<ul>
<li>基础镜像信息</li>
<li>维护者信息</li>
<li>镜像操作指令</li>
<li>容器启动时执行指令</li>
</ul>
<h3 id="2、docker-build"><a href="#2、docker-build" class="headerlink" title="2、docker build"></a>2、docker build</h3><h4 id="2-1构建"><a href="#2-1构建" class="headerlink" title="2.1构建"></a>2.1构建</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">docker build [选项] &lt;上下文路径/URL/-&gt;</span></span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">docker build -t nginx:v3 .      <span class="comment"># -t 指定镜像标签信息</span></span></span><br></pre></td></tr></table></figure>

<blockquote>
<p><strong>注意</strong>：该命令将读取指定路径下（包括子目录）的 Dockerfile，并将该路径下所有内容发送给 Docker 服务端，由服务端来创建镜像。因此<strong>一般建议放置 Dockerfile 的目录为空目录</strong>。也可以通过 <code>.dockerignore</code> 文件（每一行添加一条匹配模式）来让 Docker 忽略路径下的目录和文件。</p>
</blockquote>
<h4 id="2-2-docker-build的用法"><a href="#2-2-docker-build的用法" class="headerlink" title="2.2 docker build的用法"></a>2.2 docker build的用法</h4><p>直接用 Git repo 进行构建:</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">docker build -t hello-world https://github.com/docker-library/hello-world.git  <span class="comment">#master:amd64/hello-world</span></span></span><br></pre></td></tr></table></figure>

<p>用给定的 tar 压缩包构建</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">docker build http://server/context.tar.gz</span></span><br></pre></td></tr></table></figure>

<p>从标准输入中读取 Dockerfile 进行构建</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">docker build - &lt; Dockerfile</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">或者</span></span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash"><span class="built_in">cat</span> Dockerfile | docker build -</span></span><br></pre></td></tr></table></figure>

<p>从标准输入中读取上下文压缩包进行构建</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">docker build - &lt; context.tar.gz</span></span><br></pre></td></tr></table></figure>

<h3 id="3、指令"><a href="#3、指令" class="headerlink" title="3、指令"></a>3、指令</h3><h4 id="2-1-FROM"><a href="#2-1-FROM" class="headerlink" title="2.1 FROM"></a>2.1 FROM</h4><p><strong>功能</strong>：构建镜像基于哪个镜像。</p>
<p>格式：</p>
<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">FROM</span> &lt;image&gt; </span><br><span class="line"><span class="keyword">FROM</span> &lt;image&gt;:&lt;tag&gt;</span><br></pre></td></tr></table></figure>

<p>DockerFile第一条指令必须是FROM，同一个dockerfile中创建多个镜像时可以有多个FROM，但是不建议。</p>
<h4 id="2-2-EXPOSE"><a href="#2-2-EXPOSE" class="headerlink" title="2.2  EXPOSE"></a>2.2  EXPOSE</h4><p>暴露端口，但不映射到宿主机，只被连接的服务访问。</p>
<p>作用：</p>
<ul>
<li>帮助镜像使用者理解这个镜像服务的守护端口，以方便配置映射。</li>
<li>在运行时使用随机端口映射时，也就是 docker run -P 时，会自动随机映射 EXPOSE 的端口。</li>
</ul>
<p>格式：</p>
<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">EXPOSE</span> &lt;port1&gt; [&lt;port2&gt;...]</span><br></pre></td></tr></table></figure>

<h4 id="2-3-LABEL"><a href="#2-3-LABEL" class="headerlink" title="2.3 LABEL"></a>2.3 LABEL</h4><p><strong>功能</strong>：指令用来给镜像以键值对的形式添加一些元数据。</p>
<p>格式： </p>
<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">LABEL</span><span class="language-bash"> &lt;key&gt;=&lt;value&gt; &lt;key&gt;=&lt;value&gt; &lt;key&gt;=&lt;value&gt; ...</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>可以给镜像添加多个 <em>LABEL</em>，<strong>需要注意的是：每条 LABEL 指令都会生成一个新的层</strong>。所以最好是把添加的多个 <em>LABEL</em> 合并为一条命令</p>
</blockquote>
<h4 id="2-4-ENV"><a href="#2-4-ENV" class="headerlink" title="2.4 ENV"></a>2.4 ENV</h4><p><strong>功能</strong>：设置环境变量，定义了环境变量，那么在后续的指令中，就可以使用这个环境变量。</p>
<p>格式：</p>
<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ENV</span> &lt;key&gt; &lt;value&gt;</span><br><span class="line"><span class="keyword">ENV</span> &lt;key1&gt;=&lt;value1&gt; &lt;key2&gt;=&lt;value2&gt;...</span><br></pre></td></tr></table></figure>

<p>设置环境变量，定义了环境变量，那么在后续的指令中，就可以使用这个环境变量。</p>
<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ENV</span> NODE_VERSION <span class="number">7.2</span>.<span class="number">0</span></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> curl -SLO <span class="string">&quot;https://nodejs.org/dist/v<span class="variable">$NODE_VERSION</span>/node-v<span class="variable">$NODE_VERSION</span>-linux-x64.tar.xz&quot;</span> \</span></span><br><span class="line"><span class="language-bash">  &amp;&amp; curl -SLO <span class="string">&quot;https://nodejs.org/dist/v<span class="variable">$NODE_VERSION</span>/SHASUMS256.txt.asc&quot;</span></span></span><br></pre></td></tr></table></figure>

<h4 id="2-5-ARG"><a href="#2-5-ARG" class="headerlink" title="2.5 ARG"></a>2.5 ARG</h4><p><strong>功能</strong>：构建参数，与 ENV 作用一致。不过作用域不一样。ARG 设置的环境变量仅对 Dockerfile 内有效，也就是说只有 docker build 的过程中有效，构建好的<strong>镜像内不存在此环境变量</strong>。</p>
<p>构建命令 docker build 中可以用 –build-arg &lt;参数名&gt;=&lt;值&gt; 来覆盖。</p>
<p>格式：</p>
<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ARG</span> &lt;参数名&gt;[=&lt;默认值&gt;]</span><br></pre></td></tr></table></figure>

<h4 id="2-6-WORKDIR"><a href="#2-6-WORKDIR" class="headerlink" title="2.6 WORKDIR"></a>2.6 WORKDIR</h4><p><strong>功能</strong>：指定工作目录（进入容器时的目录）。用 WORKDIR 指定的工作目录，会在构建镜像的每一层中都存在。（WORKDIR 指定的工作目录，必须是提前创建好的）。</p>
<p>docker build 构建镜像过程中的，每一个 RUN 命令都是新建的一层。只有通过 WORKDIR 创建的目录才会一直存在。</p>
<p>格式：</p>
<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">WORKDIR</span><span class="language-bash"> &lt;工作目录路径&gt;</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>通过WORKDIR设置工作目录后，Dockerfile中其后的命令RUN、CMD、ENTRYPOINT、ADD、COPY  等命令都会在该目录下执行。在使用docker run运行容器时，可以通过-w参数覆盖构建时所设置的工作目录。</p>
</blockquote>
<h4 id="2-7-COPY"><a href="#2-7-COPY" class="headerlink" title="2.7 COPY"></a>2.7 COPY</h4><p><strong>功能</strong>：复制指令，从上下文目录中复制文件或者目录到容器里指定路径。</p>
<p>格式：</p>
<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">COPY</span><span class="language-bash"> [--<span class="built_in">chown</span>=&lt;user&gt;:&lt;group&gt;] &lt;源路径1&gt;...  &lt;目标路径&gt;</span></span><br><span class="line"><span class="keyword">COPY</span><span class="language-bash"> [--<span class="built_in">chown</span>=&lt;user&gt;:&lt;group&gt;] [<span class="string">&quot;&lt;源路径1&gt;&quot;</span>,...  <span class="string">&quot;&lt;目标路径&gt;&quot;</span>]</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>**[–chown=<user>:<group>]**：可选参数，用户改变复制到容器内文件的拥有者和属组。</p>
</blockquote>
<p>**&lt;源路径&gt;**：源文件或者源目录，这里可以是通配符表达式，其通配符规则要满足 Go 的 filepath.Match 规则。</p>
<p><strong>&lt;目标路径&gt;<strong>：容器内的指定路径，该路径不用事先建好，路径不存在的话，</strong>会自动创建</strong>。</p>
<h4 id="2-8-ADD"><a href="#2-8-ADD" class="headerlink" title="2.8  ADD"></a>2.8  ADD</h4><p>ADD 指令和 COPY 的使用格类似（同样需求下，<strong>官方推荐使用 COPY</strong>）。功能也类似，不同之处如下：</p>
<ul>
<li>ADD 的优点：在执行 &lt;源文件&gt; 为 tar 压缩文件的话，压缩格式为 gzip, bzip2 以及 xz 的情况下，会<strong>自动复制并解压</strong>到 &lt;目标路径&gt;。</li>
<li>ADD 的缺点：在不解压的前提下，无法复制 tar 压缩文件。会令镜像构建缓存失效，从而可能会令镜像构建变得比较缓慢。具体是否使用，可以根据是否需要自动解压来决定。</li>
</ul>
<h4 id="2-9-VOLUME"><a href="#2-9-VOLUME" class="headerlink" title="2.9  VOLUME"></a>2.9  VOLUME</h4><p><strong>功能</strong>：定义匿名数据卷。在启动容器时忘记挂载数据卷，会自动挂载到匿名卷。</p>
<p>作用：</p>
<ul>
<li>避免重要的数据，因容器重启而丢失，这是非常致命的。</li>
<li>避免容器不断变大。</li>
</ul>
<p>格式：</p>
<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">VOLUME</span><span class="language-bash"> [<span class="string">&quot;&lt;path1&gt;&quot;</span>, <span class="string">&quot;&lt;path2&gt;&quot;</span>...]</span></span><br><span class="line"><span class="keyword">VOLUME</span><span class="language-bash"> &lt;path&gt;</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p> <path>指定的是容器内的目录。本地目录是：/var/lib/docker/volumes/{容器ID} 。    </p>
</blockquote>
<p>在启动容器 docker run 的时候，我们可以通过 -v 参数修改挂载点。   </p>
<blockquote>
<p><strong>总结</strong>： volume只是指定了一个目录，用以在用户忘记启动时指定 -v 参数也可以保证容器的正常运行。比如mysql，你不能说用户启动时没有指定 -v ，然后删了容器，就把mysql的数据文件都删了，那样生产上是会出大事故的，所以mysql的dockerfile里面就需要配置 volume，这样即使用户没有指定 -v ，容器被删后也不会导致数据文件都不在了。还是可以恢复的。</p>
</blockquote>
<h4 id="2-10-RUN"><a href="#2-10-RUN" class="headerlink" title="2.10 RUN"></a>2.10 RUN</h4><p><strong>功能</strong>：为构建的镜像指定要运行的<strong>命令行命令</strong>，而这些命令是在 <code>docker build</code> 时执行的。</p>
<p>格式：</p>
<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># shell格式</span></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> &lt;<span class="built_in">command</span>&gt;</span></span><br><span class="line"><span class="comment"># exec格式</span></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> [<span class="string">&quot;executable&quot;</span>, <span class="string">&quot;param1&quot;</span>, <span class="string">&quot;param2&quot;</span>, ...]</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>每条 RUN 指令将在当前镜像的基础上执行指定命令，并提交为新的镜像，而 <strong>Dockerfile 的指令每执行一次都会在 docker 上新建一层，过多无意义的层，会造成镜像膨胀过大</strong>，所以建议将多个命令合并到同一个 <em>RUN</em> 指令上</p>
</blockquote>
<h4 id="2-11-CMD"><a href="#2-11-CMD" class="headerlink" title="2.11 CMD"></a>2.11 CMD</h4><p>类似于 RUN 指令，用于运行程序，但二者运行的时间点不同:</p>
<ul>
<li>CMD 在docker run 时运行。</li>
<li>RUN 是在 docker build。</li>
</ul>
<p><strong>作用</strong>：为启动的容器指定默认要运行的程序，程序运行结束，容器也就结束。CMD 指令指定的程序可被 docker run 命令行参数中指定要运行的程序所覆盖。</p>
<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 1、shell 命令格式</span></span><br><span class="line"><span class="keyword">CMD</span><span class="language-bash"> &lt;shell <span class="built_in">command</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 2、exec 命令格式：推荐 ,默认执行文件是 sh。</span></span><br><span class="line"><span class="keyword">CMD</span><span class="language-bash"> [<span class="string">&quot;&lt;可执行文件或命令&gt;&quot;</span>,<span class="string">&quot;&lt;param1&gt;&quot;</span>,<span class="string">&quot;&lt;param2&gt;&quot;</span>,...] </span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 3、该写法是为 ENTRYPOINT 指令指定的程序提供默认参数</span></span><br><span class="line"><span class="keyword">CMD</span><span class="language-bash"> [<span class="string">&quot;&lt;param1&gt;&quot;</span>,<span class="string">&quot;&lt;param2&gt;&quot;</span>,...]  </span></span><br></pre></td></tr></table></figure>

<p><strong>注意</strong>：</p>
<ul>
<li>如果 Dockerfile 中如果存在多个 CMD 指令，仅最后一个生效。</li>
<li>如果 <code>docker run</code> 命令行参数中指定了要运行的程序命令，则会覆盖<em>CMD</em> 指令指定的程序命令。</li>
</ul>
<h4 id="2-12-ENTRYPOINT"><a href="#2-12-ENTRYPOINT" class="headerlink" title="2.12 ENTRYPOINT"></a>2.12 ENTRYPOINT</h4><p><strong>功能</strong>：类似于 CMD 指令，但其不会被 docker run 的命令行参数指定的指令所覆盖，而且这些命令行参数会被当作参数送给 ENTRYPOINT 指令指定的程序。</p>
<p>但是, 如果运行 docker run 时使用了 –entrypoint 选项，将覆盖 ENTRYPOINT 指令指定的程序。</p>
<p><strong>优点</strong>：在执行 docker run 的时候可以指定 ENTRYPOINT 运行所需的参数。</p>
<p> <strong>注意</strong>：如果 Dockerfile 中如果存在多个 ENTRYPOINT 指令，仅最后一个生效。</p>
<p>格式：</p>
<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ENTRYPOINT</span><span class="language-bash"> [<span class="string">&quot;&lt;executeable&gt;&quot;</span>,<span class="string">&quot;&lt;param1&gt;&quot;</span>,<span class="string">&quot;&lt;param2&gt;&quot;</span>,...]</span></span><br></pre></td></tr></table></figure>

<p>可以搭配 CMD 命令使用：一般是变参才会使用 CMD ，这里的 CMD 等于是在给 ENTRYPOINT 传参，以下示例会提到。</p>
<p>示例：</p>
<p>假设已通过 Dockerfile 构建了 nginx:test 镜像：</p>
<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">FROM</span> nginx</span><br><span class="line"></span><br><span class="line"><span class="keyword">ENTRYPOINT</span><span class="language-bash"> [<span class="string">&quot;nginx&quot;</span>, <span class="string">&quot;-c&quot;</span>] <span class="comment"># 定参</span></span></span><br><span class="line"><span class="keyword">CMD</span><span class="language-bash"> [<span class="string">&quot;/etc/nginx/nginx.conf&quot;</span>] <span class="comment"># 变参 </span></span></span><br></pre></td></tr></table></figure>

<p>1、不传参运行</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">docker run  nginx:<span class="built_in">test</span></span></span><br></pre></td></tr></table></figure>

<p>容器内会默认运行以下命令，启动主进程。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">nginx -c /etc/nginx/nginx.conf</span></span><br></pre></td></tr></table></figure>

<p>2、传参运行</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">docker run  nginx:<span class="built_in">test</span> -c /etc/nginx/new.conf</span></span><br></pre></td></tr></table></figure>

<p>容器内会默认运行以下命令，启动主进程(/etc/nginx/new.conf:假设容器内已有此文件)</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">nginx -c /etc/nginx/new.conf</span></span><br></pre></td></tr></table></figure>

<h4 id="2-13-HEALTHCHECK"><a href="#2-13-HEALTHCHECK" class="headerlink" title="2.13 HEALTHCHECK"></a>2.13 HEALTHCHECK</h4><p><strong>功能</strong>：用于指定某个程序或者指令来监控 docker 容器服务的运行状态。</p>
<p>格式：</p>
<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">HEALTHCHECK</span><span class="language-bash"> [选项] CMD &lt;命令&gt;：设置检查容器健康状况的命令</span></span><br><span class="line"><span class="keyword">HEALTHCHECK</span><span class="language-bash"> NONE：如果基础镜像有健康检查指令，使用这行可以屏蔽掉其健康检查指令</span></span><br><span class="line"><span class="keyword">HEALTHCHECK</span><span class="language-bash"> [选项] CMD &lt;命令&gt; : 这边 CMD 后面跟随的命令使用，可以参考 CMD 的用法。</span></span><br></pre></td></tr></table></figure>

<h4 id="2-14-USER"><a href="#2-14-USER" class="headerlink" title="2.14 USER"></a>2.14 USER</h4><p><strong>功能</strong>：用于指定执行后续命令的用户和用户组，这边只是切换后续命令执行的用户（用户和用户组必须提前已经存在）。</p>
<p>可以使用用户名、UID或GID。</p>
<p>格式：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">USER &lt;user&gt;[:&lt;group&gt;]</span><br></pre></td></tr></table></figure>

<h4 id="2-15-ONBUILD"><a href="#2-15-ONBUILD" class="headerlink" title="2.15 ONBUILD"></a>2.15 ONBUILD</h4><p><strong>功能：</strong>触发器。 用于延迟构建命令的执行。简单的说，就是 Dockerfile 里用 ONBUILD 指定的命令，在本次构建镜像的过程中不会执行（假设镜像为 test-build）。当有新的 Dockerfile 使用了之前构建的镜像 FROM test-build ，这时执行新镜像的 Dockerfile 构建时候，会执行 test-build 的 Dockerfile 里的 ONBUILD 指定的命令。</p>
<p>格式：</p>
<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ONBUILD</span> [INSTRUCTION]</span><br></pre></td></tr></table></figure>

<h3 id="3-DockerFile模版"><a href="#3-DockerFile模版" class="headerlink" title="3. DockerFile模版"></a>3. DockerFile模版</h3><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">FROM</span> node:<span class="number">7</span>-alpine  </span><br><span class="line"><span class="keyword">LABEL</span><span class="language-bash"> maintainer <span class="string">&quot;jakub.skalecki@example.com&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">ENV</span> PROJECT_DIR=/app  </span><br><span class="line"><span class="keyword">WORKDIR</span><span class="language-bash"> <span class="variable">$PROJECT_DIR</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">COPY</span><span class="language-bash"> package.json <span class="variable">$PROJECT_DIR</span>  </span></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> npm install  </span></span><br><span class="line"><span class="keyword">COPY</span><span class="language-bash"> . <span class="variable">$PROJECT_DIR</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">ENV</span> MEDIA_DIR=/media \  </span><br><span class="line">    NODE_ENV=production \</span><br><span class="line">    APP_PORT=<span class="number">3000</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">VOLUME</span><span class="language-bash"> <span class="variable">$MEDIA_DIR</span>  </span></span><br><span class="line"><span class="keyword">EXPOSE</span> $APP_PORT  </span><br><span class="line"><span class="comment"># 健康检查， 如果一切正常的话返回 0，否则返回 1：</span></span><br><span class="line"><span class="keyword">HEALTHCHECK</span><span class="language-bash"> CMD curl --fail http://localhost:<span class="variable">$APP_PORT</span> || <span class="built_in">exit</span> 1</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">ENTRYPOINT</span><span class="language-bash"> [<span class="string">&quot;./entrypoint.sh&quot;</span>]  </span></span><br><span class="line"><span class="keyword">CMD</span><span class="language-bash"> [<span class="string">&quot;start&quot;</span>]</span></span><br></pre></td></tr></table></figure>

<h2 id="五、Docker-Compose"><a href="#五、Docker-Compose" class="headerlink" title="五、Docker Compose"></a>五、Docker Compose</h2><h3 id="1、简介"><a href="#1、简介" class="headerlink" title="1、简介"></a>1、简介</h3><p>Compose 是用于定义和运行多容器 Docker 应用程序的工具。通过 Compose，您可以使用 YML 文件来配置应用程序需要的所有服务。然后，使用一个命令，就可以从 YML 文件配置中创建并启动所有服务。</p>
<p><code>Compose</code> 中有两个重要的概念：</p>
<ul>
<li>服务 (<code>service</code>)：一个应用的容器，实际上可以包括若干运行相同镜像的容器实例。</li>
<li>项目 (<code>project</code>)：由一组关联的应用容器组成的一个完整业务单元，在 <code>docker-compose.yml</code> 文件中定义。</li>
</ul>
<h3 id="2、命令说明"><a href="#2、命令说明" class="headerlink" title="2、命令说明"></a>2、命令说明</h3><h4 id="2-1-基本格式"><a href="#2-1-基本格式" class="headerlink" title="2.1 基本格式"></a>2.1 基本格式</h4><p><code>docker-compose</code> 命令的基本的使用格式是</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">docker-compose [-f=&lt;arg&gt;...] [options] [COMMAND] [ARGS...]</span></span><br></pre></td></tr></table></figure>

<h4 id="2-2-命令选项"><a href="#2-2-命令选项" class="headerlink" title="2.2 命令选项"></a>2.2 命令选项</h4><ul>
<li><code>-f, --file FILE</code> 指定使用的 Compose 模板文件，默认为 <code>docker-compose.yml</code>，可以多次指定。</li>
<li><code>-p, --project-name NAME</code> 指定项目名称，默认将使用所在目录名称作为项目名。</li>
<li><code>--verbose</code> 输出更多调试信息。</li>
<li><code>-v, --version</code> 打印版本并退出。</li>
</ul>
<h4 id="2-3-常用命令"><a href="#2-3-常用命令" class="headerlink" title="2.3 常用命令"></a>2.3 常用命令</h4><blockquote>
<p>  基本跟docker 容器操作命令类似，基本都有</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">docker-compose --<span class="built_in">help</span></span></span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">docker-compose up        <span class="comment"># -d 后台启动应用，推荐生产环境后台启动</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">自动完成包括构建镜像，（重新）创建服务，启动服务，并关联服务相关容器的一系列操作。</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">链接的服务都将会被自动启动，除非已经处于运行状态。</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">docker-compose down      <span class="comment"># 此命令将会停止 up 命令所启动的容器，并容器、网络、卷、镜像</span></span></span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">docker-compose ps        <span class="comment"># 列出项目中的所有容器。</span></span></span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">docker-compose config    <span class="comment"># 检验compose文件</span></span></span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">docker-compose port      <span class="comment"># 打印某个容器所映射的公共端口</span></span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">-f 可以指定不同yml文件模板用于构建镜像</span></span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">docker-compose build     <span class="comment"># 服务容器一旦构建后，将会带上一个标记名</span></span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">指定服务运行的数量</span></span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">docker-compose scale web=3 db=2    <span class="comment"># 启动3个web服务，2个db服务</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">一般的，当指定数目多于该服务当前实际运行容器，将新创建并启动容器；反之，将停止容器。</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>  默认情况，如果服务容器已经存在，<code>docker-compose up</code> 将会尝试停止容器，然后重新创建（保持使用 <code>volumes-from</code> 挂载的卷），以保证新启动的服务匹配 <code>docker-compose.yml</code> 文件的最新内容。如果用户不希望容器被停止并重新创建，可以使用 <code>docker-compose up --no-recreate</code>。这样将只会启动处于停止状态的容器，而忽略已经运行的服务。如果用户只想重新部署某个服务，可以使用 <code>docker-compose up --no-deps -d &lt;SERVICE_NAME&gt;</code> 来重新创建服务并后台停止旧服务，启动新服务，并不会影响到其所依赖的服务。</p>
</blockquote>
<h3 id="3、使用"><a href="#3、使用" class="headerlink" title="3、使用"></a>3、使用</h3><p>Compose 使用的三个步骤：</p>
<ul>
<li>使用 Dockerfile 定义应用程序的环境。</li>
<li>使用 docker-compose.yml 定义构成应用程序的服务，这样它们可以在隔离环境中一起运行。</li>
<li>最后，执行 docker-compose up 命令来启动并运行整个应用程序。</li>
</ul>
<h3 id="Compose-模板文件"><a href="#Compose-模板文件" class="headerlink" title="Compose 模板文件"></a>Compose 模板文件</h3><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">version:</span> <span class="string">&quot;3&quot;</span></span><br><span class="line"><span class="attr">services:</span></span><br><span class="line">  <span class="attr">web1:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">bc-mall</span></span><br><span class="line">    <span class="attr">hostname:</span> <span class="string">server1</span></span><br><span class="line">    <span class="attr">restart:</span> <span class="string">on-failure</span></span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&quot;./config/config.env:/root/config/config.env&quot;</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&quot;8093:8093&quot;</span></span><br><span class="line">    <span class="attr">network_mode:</span> <span class="string">bridge</span></span><br><span class="line"></span><br><span class="line">  <span class="attr">web2:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">bc-mall</span></span><br><span class="line">    <span class="attr">hostname:</span> <span class="string">server2</span></span><br><span class="line">    <span class="attr">restart:</span> <span class="string">on-failure</span></span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&quot;./config/config1.env:/root/config/config.env&quot;</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&quot;8094:8094&quot;</span></span><br><span class="line">    <span class="attr">network_mode:</span> <span class="string">bridge</span></span><br><span class="line"></span><br><span class="line">  <span class="attr">web3:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">bc-mall</span></span><br><span class="line">    <span class="attr">hostname:</span> <span class="string">server3</span></span><br><span class="line">    <span class="attr">restart:</span> <span class="string">on-failure</span></span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&quot;./config/config2.env:/root/config/config.env&quot;</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&quot;8095:8095&quot;</span></span><br><span class="line">    <span class="attr">network_mode:</span> <span class="string">bridge</span></span><br></pre></td></tr></table></figure>

<h3 id="Docker-compose-yml配置文件"><a href="#Docker-compose-yml配置文件" class="headerlink" title="Docker-compose.yml配置文件"></a>Docker-compose.yml配置文件</h3><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">version:</span> <span class="string">&#x27;3&#x27;</span></span><br><span class="line"><span class="attr">services:</span></span><br><span class="line"> <span class="comment"># 第一部分: Building(构建镜像)</span></span><br><span class="line"> <span class="attr">web:</span></span><br><span class="line">  <span class="comment"># 使用当前目录下的Dockerfile</span></span><br><span class="line">  <span class="attr">build:</span> <span class="string">.</span></span><br><span class="line">  <span class="attr">args:</span> <span class="comment"># 增加额外参数</span></span><br><span class="line">    <span class="attr">APP_HOME:</span> <span class="string">app</span></span><br><span class="line">  <span class="attr">volumes:</span> <span class="comment"># 目录挂载</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">.:/code</span></span><br><span class="line">  <span class="attr">depends_on:</span> <span class="comment"># 依赖db和redis</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">db</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">redis</span></span><br><span class="line">    </span><br><span class="line">  <span class="comment"># 使用定制化的Dockerfile，指定新目录相对路径和文件名</span></span><br><span class="line">  <span class="attr">build:</span></span><br><span class="line">    <span class="attr">context:</span> <span class="string">./dir</span> </span><br><span class="line">    <span class="attr">dockerfile:</span> <span class="string">Dockerfile.dev</span></span><br><span class="line">    <span class="attr">container_name:</span> <span class="string">app</span> <span class="comment"># 自定义容器名</span></span><br><span class="line">    </span><br><span class="line">  <span class="comment"># 基于现有镜像构建</span></span><br><span class="line">  <span class="attr">image:</span> <span class="string">ubuntu</span></span><br><span class="line">  <span class="attr">image:</span> <span class="string">ubuntu:14.04</span></span><br><span class="line">  <span class="attr">image:</span> <span class="string">remote-registry:4000/postgresql</span></span><br><span class="line">  <span class="attr">image:</span> <span class="string">bcbc65fd</span></span><br><span class="line">  </span><br><span class="line">  <span class="comment"># 第二部分: Ports(端口)</span></span><br><span class="line">  <span class="attr">ports:</span> <span class="comment"># 指定端口映射，HOST:Container</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">&quot;6379&quot;</span> <span class="comment"># 指定容器的端口6379，宿主机会随机映射端口</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">&quot;8080:80&quot;</span>  <span class="comment"># 宿主机端口8080，对应容器80</span></span><br><span class="line"></span><br><span class="line">  <span class="comment"># 暴露端口给-link或处于同一网络的容器，不暴露给宿主机。</span></span><br><span class="line">  <span class="attr">expose:</span> [<span class="string">&quot;3000&quot;</span>]</span><br><span class="line">  </span><br><span class="line">  <span class="comment"># 第三部分: Environment Variables(环境变量)</span></span><br><span class="line">  <span class="attr">environment:</span></span><br><span class="line">    <span class="attr">MODE:</span> <span class="string">development</span></span><br><span class="line">    <span class="attr">SHOW:</span> <span class="string">&#x27;true&#x27;</span></span><br><span class="line">    </span><br><span class="line">  <span class="comment"># 等同于</span></span><br><span class="line">  <span class="attr">environment:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">MODE=development</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">SHOW:</span> <span class="string">&#x27;true&#x27;</span></span><br><span class="line">  </span><br><span class="line">  <span class="comment"># 使用环境变量.env文件</span></span><br><span class="line">  <span class="attr">env_file:</span> <span class="string">.env</span></span><br><span class="line">  <span class="attr">env_file:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">./common.env</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">./apps/web.env</span></span><br><span class="line"></span><br><span class="line">  <span class="comment"># 第四部分：commands (命令)</span></span><br><span class="line">  <span class="comment"># 容器启动后默认执行命令</span></span><br><span class="line">  <span class="attr">command:</span> <span class="string">bundle</span> <span class="string">exec</span> <span class="string">thin</span> <span class="string">-p</span> <span class="number">3000</span></span><br><span class="line">  <span class="attr">command:</span> [<span class="string">&#x27;/bin/bash/&#x27;</span>, <span class="string">&#x27;start.sh&#x27;</span>]</span><br><span class="line"> </span><br><span class="line">  <span class="comment"># 容器启动后程序入口</span></span><br><span class="line">  <span class="attr">entrypoint:</span> <span class="string">/code/entrypoint.sh</span></span><br><span class="line">  </span><br><span class="line">  <span class="comment"># 第五部分：Networks(网络)</span></span><br><span class="line">  <span class="attr">networks:</span> <span class="comment"># 使用bridge驱动创建名为frontend的网络</span></span><br><span class="line">    <span class="attr">frontend:</span></span><br><span class="line">      <span class="attr">driver:</span> <span class="string">bridge</span></span><br><span class="line">    </span><br><span class="line">    <span class="attr">networks:</span> <span class="comment"># 使用创建的网络进行通信</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">frontend</span></span><br><span class="line">      </span><br><span class="line">    <span class="comment"># 加入已经存在的外部网络</span></span><br><span class="line">    <span class="attr">networks:</span> </span><br><span class="line">      <span class="attr">default:</span></span><br><span class="line">        <span class="attr">external:</span></span><br><span class="line">          <span class="attr">name:</span> <span class="string">my-pre-existing-network</span></span><br><span class="line"></span><br><span class="line">  <span class="comment"># 第六部分：Volumes(数据卷)</span></span><br><span class="line">  <span class="attr">volumes:</span> <span class="comment"># 创建名为postgres_data的数据卷</span></span><br><span class="line">    <span class="attr">postgres_data:</span></span><br><span class="line">    </span><br><span class="line">    <span class="attr">db:</span></span><br><span class="line">      <span class="attr">image:</span> <span class="string">postgres:latest</span></span><br><span class="line">      <span class="attr">volumes:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">postgres_data:/var/lib/postgresql/data</span></span><br><span class="line">      </span><br><span class="line">  <span class="comment"># 第七部分：External Links(外部链接)</span></span><br><span class="line">  <span class="comment"># 目的是让Compose能够连接那些不在docker-compose.yml中定义的单独运行容器</span></span><br><span class="line">  <span class="attr">services:</span></span><br><span class="line">    <span class="attr">web:</span></span><br><span class="line">      <span class="attr">external_links:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">redis_1</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">project_db_1:mysql</span></span><br></pre></td></tr></table></figure>

<h2 id="六、etcd"><a href="#六、etcd" class="headerlink" title="六、etcd"></a>六、etcd</h2><blockquote>
<p><a target="_blank" rel="noopener" href="https://www.kancloud.cn/roeslys/linux/1593364">https://www.kancloud.cn/roeslys/linux/1593364</a></p>
</blockquote>
<p>简介：Etcd 是什么</p>
<ul>
<li>etcd是一个分布式可靠的键值存储，用于分布式系统的最关键数据，重点是：</li>
</ul>
<p>1.<em>简单</em>：定义明确，面向用户的API（gRPC）</p>
<p>2.<em>安全</em>：具有可选客户端证书身份验证的自动TLS</p>
<p>3.<em>快速</em>：基准测试10,000次/秒</p>
<p>4.<em>可靠</em>：使用Raft一致性算法分布集群</p>
<ul>
<li>etcd是用Go编写的，使用<a target="_blank" rel="noopener" href="https://raft.github.io/">Raft</a>一致性算法来管理高度可用的复制日志。</li>
<li>etcd被<a target="_blank" rel="noopener" href="https://github.com/coreos/etcd/blob/master/Documentation/production-users.md">许多公司</a>用于<a target="_blank" rel="noopener" href="https://github.com/coreos/etcd/blob/master/Documentation/production-users.md">生产</a>，开发团队在关键部署场景中支持它，其中etcd经常与<a target="_blank" rel="noopener" href="http://kubernetes.io/">Kubernetes</a>，<a target="_blank" rel="noopener" href="https://github.com/coreos/locksmith">locksmith</a>，<a target="_blank" rel="noopener" href="https://github.com/vulcand/vulcand">vulcand</a>，<a target="_blank" rel="noopener" href="https://github.com/youtube/doorman">Doorman</a>等许多应用程序配合使用。通过<strong>严格的测试</strong>进一步确保可靠性。</li>
<li>有关简单的命令行客户端，请参阅<a target="_blank" rel="noopener" href="https://github.com/coreos/etcd/tree/master/etcdctl">etcdctl</a>(etcdctl –helper)</li>
</ul>
<h3 id="一、ETCD单机部署"><a href="#一、ETCD单机部署" class="headerlink" title="一、ETCD单机部署"></a>一、ETCD单机部署</h3><h5 id="1、下载二进制包"><a href="#1、下载二进制包" class="headerlink" title="1、下载二进制包"></a>1、下载二进制包</h5><p><a target="_blank" rel="noopener" href="https://github.com/coreos/etcd/releases">https://github.com/coreos/etcd/releases</a></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wget https://github.com/etcd-io/etcd/releases/download/v3.3.12/etcd-v3.3.12-linux-arm64.tar.gz</span><br></pre></td></tr></table></figure>

<h5 id="2、解压缩"><a href="#2、解压缩" class="headerlink" title="2、解压缩"></a>2、解压缩</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tar -zxvf etcd-v3.3.12-linux-arm64.tar.gz</span><br></pre></td></tr></table></figure>

<h5 id="3、设置环境变量"><a href="#3、设置环境变量" class="headerlink" title="3、设置环境变量"></a>3、设置环境变量</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">export ETCDPATH=&quot;/home/etcd/etcd-v3.3.12-linux-amd64&quot;</span><br><span class="line"></span><br><span class="line">export ETCDCTL_API=3</span><br><span class="line"></span><br><span class="line">export PATH=&quot;$PATH:$ETCDPATH&quot;</span><br></pre></td></tr></table></figure>

<h5 id="4、启动etcd"><a href="#4、启动etcd" class="headerlink" title="4、启动etcd"></a>4、启动etcd</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">etcd --data-dir $ETCDPATH/test_data</span><br></pre></td></tr></table></figure>

<h5 id="5、客户端测试"><a href="#5、客户端测试" class="headerlink" title="5、客户端测试"></a>5、客户端测试</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">etcdctl --endpoints=http://127.0.0.1:2379 put foo bar</span><br><span class="line"></span><br><span class="line">etcdctl --endpoints=http://127.0.0.1:2379 get foo</span><br><span class="line">[root@bogon /]# etcdctl --endpoints=http://127.0.0.1:2379 put foo bar</span><br><span class="line">OK</span><br><span class="line">[root@bogon /]# etcdctl --endpoints=http://127.0.0.1:2379 get foo</span><br><span class="line">foo</span><br><span class="line">bar</span><br></pre></td></tr></table></figure>

<h3 id="二、docker单机部署ETCD"><a href="#二、docker单机部署ETCD" class="headerlink" title="二、docker单机部署ETCD"></a>二、docker单机部署ETCD</h3><h5 id="1、拉取etcd镜像"><a href="#1、拉取etcd镜像" class="headerlink" title="1、拉取etcd镜像"></a>1、拉取etcd镜像</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker pull quay.io/coreos/etcd:v3.3.9</span><br></pre></td></tr></table></figure>

<h5 id="2、设置环境变量和监听地址"><a href="#2、设置环境变量和监听地址" class="headerlink" title="2、设置环境变量和监听地址"></a>2、设置环境变量和监听地址</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">-e ETCDCTL_API=3</span><br><span class="line"></span><br><span class="line">-p 2379:2379 -p 2380:2380</span><br></pre></td></tr></table></figure>

<h5 id="3、运行etcd容器"><a href="#3、运行etcd容器" class="headerlink" title="3、运行etcd容器"></a>3、运行etcd容器</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">docker run -d -it --rm \</span><br><span class="line">--name etcd_test \</span><br><span class="line">-e ETCDCTL_API=3 \</span><br><span class="line">-p 2379:2379 \</span><br><span class="line">-p 2380:2380 \</span><br><span class="line">quay.io/coreos/etcd:v3.3.9 \</span><br><span class="line">etcd \</span><br><span class="line">--advertise-client-urls http://0.0.0.0:2379 \</span><br><span class="line">--listen-client-urls http://0.0.0.0:2379</span><br></pre></td></tr></table></figure>

<p>容器退出自动删除rm</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@bogon etcd]# docker run -d -it --rm --name etcd_test -e ETCDCTL_API=3 -p 2379:2379 -p 2380:2380 quay.io/coreos/etcd:v3.3.9 etcd --advertise-client-urls http://0.0.0.0:2379 --listen-client-urls http://0.0.0.0:2379</span><br><span class="line">ca444c094b6bf00b47726b0dee600620d3962cd0fb78d224db9fae12da94dc13</span><br></pre></td></tr></table></figure>

<p>容器停止总是重启</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@ansible-server ~]# docker run -d -it --restart=always --name etcd1 -e ETCDCTL_API=3 -p 2379:2379 -p 2380:2380 quay.io/coreos/etcd:v3.3.9 etcd --advertise-client-urls http://0.0.0.0:2379 --listen-client-urls http://0.0.0.0:2379</span><br><span class="line">199b521dcdd1a742701350c8024dd76c179db2ded0d05a40dd44adfd14f2fb27</span><br></pre></td></tr></table></figure>

<p>其他状态：</p>
<ul>
<li>no，默认策略，在容器退出时不重启容器</li>
<li>on-failure，在容器非正常退出时（退出状态非0），才会重启容器</li>
<li>on-failure:3，在容器非正常退出时重启容器，最多重启3次</li>
<li>always，在容器退出时总是重启容器</li>
<li>unless-stopped，在容器退出时总是重启容器，但是不考虑在Docker守护进程启动时就已经停止了的容器</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@bogon etcd]# docker ps -a</span><br><span class="line">CONTAINER ID        IMAGE                        COMMAND                  CREATED             STATUS              PORTS                              NAMES</span><br><span class="line">ca444c094b6b        quay.io/coreos/etcd:v3.3.9   &quot;etcd --advertise-...&quot;   4 seconds ago       Up 3 seconds        0.0.0.0:2379-2380-&gt;2379-2380/tcp   etcd_test</span><br></pre></td></tr></table></figure>

<h5 id="4、客户端测试"><a href="#4、客户端测试" class="headerlink" title="4、客户端测试"></a>4、客户端测试</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">etcdctl --endpoints=http://127.0.0.1:2379 put foo bar</span><br><span class="line"></span><br><span class="line">etcdctl --endpoints=http://127.0.0.1:2379 get foo</span><br><span class="line">[root@bogon etcd]# etcdctl --endpoints=http://127.0.0.1:2379 put foo bar</span><br><span class="line">OK</span><br><span class="line">[root@bogon etcd]# etcdctl --endpoints=http://127.0.0.1:2379 get foo</span><br><span class="line">foo</span><br><span class="line">bar</span><br><span class="line">[root@bogon etcd]# etcdctl --endpoints=http://127.0.0.1:2379 put foo bar1</span><br><span class="line">OK</span><br><span class="line">[root@bogon etcd]# etcdctl --endpoints=http://127.0.0.1:2379 get foo</span><br><span class="line">foo</span><br><span class="line">bar1</span><br></pre></td></tr></table></figure>

<h3 id="三、Etcd本地集群（使用goreman管理）"><a href="#三、Etcd本地集群（使用goreman管理）" class="headerlink" title="三、Etcd本地集群（使用goreman管理）"></a>三、Etcd本地集群（使用goreman管理）</h3><h4 id="1、下载etcd二进制包-amp-amp-设置环境变量-amp-amp-参考Etcd单机部署"><a href="#1、下载etcd二进制包-amp-amp-设置环境变量-amp-amp-参考Etcd单机部署" class="headerlink" title="1、下载etcd二进制包&amp;&amp;设置环境变量&amp;&amp;参考Etcd单机部署"></a>1、下载etcd二进制包&amp;&amp;设置环境变量&amp;&amp;参考Etcd单机部署</h4><h4 id="2、安装goreman，安装goreman前需要安装go环境和git。"><a href="#2、安装goreman，安装goreman前需要安装go环境和git。" class="headerlink" title="2、安装goreman，安装goreman前需要安装go环境和git。"></a>2、安装goreman，安装goreman前需要安装go环境和git。</h4><h4 id="3、安装go环境"><a href="#3、安装go环境" class="headerlink" title="3、安装go环境"></a>3、安装go环境</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">wget https://studygolang.com/dl/golang/go1.10.1.linux-amd64.tar.gz</span><br><span class="line"></span><br><span class="line">tar -xvf go1.10.1.linux-amd64.tar.gz</span><br><span class="line"></span><br><span class="line">vim /etc/profile</span><br><span class="line"></span><br><span class="line">export GOROOT=/home/go/go</span><br><span class="line">export GOPATH=/home/go/data</span><br><span class="line">export PATH=$PATH:$GOROOT/bin:$GOPATH/bin</span><br><span class="line">source /etc/profile</span><br></pre></td></tr></table></figure>

<h4 id="4、安装git"><a href="#4、安装git" class="headerlink" title="4、安装git"></a>4、安装git</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum -y install git</span><br></pre></td></tr></table></figure>

<h4 id="5、安装-goreman"><a href="#5、安装-goreman" class="headerlink" title="5、安装 goreman"></a>5、安装 goreman</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">go get github.com/mattn/goreman</span><br></pre></td></tr></table></figure>

<p>下载后的文件在<code>export GOPATH=/home/go/data</code>设置的路径中</p>
<h4 id="6、编写Procfile（管理集群）"><a href="#6、编写Procfile（管理集群）" class="headerlink" title="6、编写Procfile（管理集群）"></a>6、编写Procfile（管理集群）</h4><p><a target="_blank" rel="noopener" href="https://github.com/coreos/etcd/blob/master/Procfile">https://github.com/coreos/etcd/blob/master/Procfile</a></p>
<h4 id="7、启动etcd（goreman-runlist）"><a href="#7、启动etcd（goreman-runlist）" class="headerlink" title="7、启动etcd（goreman runlist）"></a>7、启动etcd（goreman runlist）</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">goreman -f Procfile start</span><br></pre></td></tr></table></figure>

<h3 id="四、docker-cluster（集群）"><a href="#四、docker-cluster（集群）" class="headerlink" title="四、docker cluster（集群）"></a>四、docker cluster（集群）</h3><h4 id="8、etcd集群"><a href="#8、etcd集群" class="headerlink" title="8、etcd集群"></a>8、etcd集群</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker pull busybox</span><br></pre></td></tr></table></figure>

<h5 id="docker-netword"><a href="#docker-netword" class="headerlink" title="docker netword"></a>docker netword</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">#docker network create etcd_cluster</span><br><span class="line"></span><br><span class="line">docker network create --subnet 172.16.3.0/16 etcd_cluster</span><br><span class="line"></span><br><span class="line">docker network inspect etcd_cluster</span><br><span class="line"></span><br><span class="line">#docker network rm etcd_cluster</span><br><span class="line"></span><br><span class="line">docker run -itd --rm --network etcd_cluster --ip 172.16.3.0 --name test busybox</span><br><span class="line">docker network ls</span><br><span class="line">docker network rm etcd_cluster</span><br></pre></td></tr></table></figure>

<h4 id="9、etcd-cluster"><a href="#9、etcd-cluster" class="headerlink" title="9、etcd cluster"></a>9、etcd cluster</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br></pre></td><td class="code"><pre><span class="line"># etcd1</span><br><span class="line">docker run -itd --restart=always \</span><br><span class="line">    --network etcd_cluster \</span><br><span class="line">    --ip 172.16.3.31 \</span><br><span class="line">    --hostname etcd1 \</span><br><span class="line">    --name etcd1 \</span><br><span class="line">    -e ETCDCTL_API=3 \</span><br><span class="line">    -p 12379:2379 \</span><br><span class="line">    -p 12380:2380 \</span><br><span class="line">    quay.io/coreos/etcd:v3.3.9 \</span><br><span class="line">    etcd --name etcd1 \</span><br><span class="line">    --initial-advertise-peer-urls http://172.16.3.31:2380 \</span><br><span class="line">    --listen-peer-urls http://172.16.3.31:2380 \</span><br><span class="line">    --listen-client-urls http://172.16.3.31:2379,http://127.0.0.1:2379 \</span><br><span class="line">    --advertise-client-urls http://172.16.3.31:2379 \</span><br><span class="line">    --initial-cluster-token etcd-cluster-1 \</span><br><span class="line">    --initial-cluster etcd1=http://172.16.3.31:2380,etcd2=http://172.16.3.32:2380,etcd3=http://172.16.3.33:2380 \</span><br><span class="line">    --initial-cluster-state new</span><br><span class="line">    </span><br><span class="line">  # etcd2  </span><br><span class="line">    docker run -itd --restart=always \</span><br><span class="line">    --network etcd_cluster \</span><br><span class="line">    --ip 172.16.3.32 \</span><br><span class="line">    --hostname etcd2 \</span><br><span class="line">    --name etcd2 \</span><br><span class="line">    -e ETCDCTL_API=3 \</span><br><span class="line">    -p 22379:2379 \</span><br><span class="line">    -p 22380:2380 \</span><br><span class="line">    quay.io/coreos/etcd:v3.3.9 \</span><br><span class="line">    etcd --name etcd2 \</span><br><span class="line">    --initial-advertise-peer-urls http://172.16.3.32:2380 \</span><br><span class="line">    --listen-peer-urls http://172.16.3.32:2380 \</span><br><span class="line">    --listen-client-urls http://172.16.3.32:2379,http://127.0.0.1:2379 \</span><br><span class="line">    --advertise-client-urls http://172.16.3.32:2379 \</span><br><span class="line">    --initial-cluster-token etcd-cluster-1 \</span><br><span class="line">    --initial-cluster etcd1=http://172.16.3.31:2380,etcd2=http://172.16.3.32:2380,etcd3=http://172.16.3.33:2380 \</span><br><span class="line">    --initial-cluster-state new</span><br><span class="line">  </span><br><span class="line">  # etcd3</span><br><span class="line">    docker run -itd --restart=always \</span><br><span class="line">    --network etcd_cluster \</span><br><span class="line">    --ip 172.16.3.33 \</span><br><span class="line">    --hostname etcd3 \</span><br><span class="line">    --name etcd3 \</span><br><span class="line">    -e ETCDCTL_API=3 \</span><br><span class="line">    -p 32379:2379 \</span><br><span class="line">    -p 32380:2380 \</span><br><span class="line">    quay.io/coreos/etcd:v3.3.9 \</span><br><span class="line">    etcd --name etcd3 \</span><br><span class="line">    --initial-advertise-peer-urls http://172.16.3.33:2380 \</span><br><span class="line">    --listen-peer-urls http://172.16.3.33:2380 \</span><br><span class="line">    --listen-client-urls http://172.16.3.33:2379,http://127.0.0.1:2379 \</span><br><span class="line">    --advertise-client-urls http://172.16.3.33:2379 \</span><br><span class="line">    --initial-cluster-token etcd-cluster-1 \</span><br><span class="line">    --initial-cluster etcd1=http://172.16.3.31:2380,etcd2=http://172.16.3.32:2380,etcd3=http://172.16.3.33:2380 \</span><br><span class="line">    --initial-cluster-state new</span><br><span class="line">    </span><br><span class="line"> # client</span><br><span class="line"> #进入容器 </span><br><span class="line">docker exec -it etcd1 bin/sh</span><br><span class="line">#客户端测试</span><br><span class="line">etcdctl --write-out=table --endpoints=http://127.0.0.1:2379 member list</span><br><span class="line">etcdctl --endpoints=http://127.0.0.1:2379 put foo bar</span><br><span class="line">etcdctl --endpoints=http://127.0.0.1:2379 get foo</span><br><span class="line"></span><br><span class="line">#测试结果如下</span><br><span class="line">[root@bogon ~]# docker exec -it etcd1 bin/sh</span><br><span class="line">/ # etcdctl --write-out=table --endpoints=http://127.0.0.1:2379 member list</span><br><span class="line">+------------------+---------+-------+-------------------------+-------------------------+</span><br><span class="line">|        ID        | STATUS  | NAME  |       PEER ADDRS        |      CLIENT ADDRS       |</span><br><span class="line">+------------------+---------+-------+-------------------------+-------------------------+</span><br><span class="line">|  c26d6ba798c079c | started | etcd3 | http://172.16.3.33:2380 | http://172.16.3.33:2379 |</span><br><span class="line">| 4631df2115e1ef72 | started | etcd2 | http://172.16.3.32:2380 | http://172.16.3.32:2379 |</span><br><span class="line">| a92fe5422902bc40 | started | etcd1 | http://172.16.3.31:2380 | http://172.16.3.31:2379 |</span><br><span class="line">+------------------+---------+-------+-------------------------+-------------------------+</span><br><span class="line">/ # etcdctl --endpoints=http://127.0.0.1:2379 put foo bar</span><br><span class="line">OK</span><br><span class="line">/ # etcdctl --endpoints=http://127.0.0.1:2379 get foo</span><br><span class="line">foo</span><br><span class="line">bar</span><br><span class="line">#docker ps</span><br><span class="line">[root@bogon docker]# docker ps</span><br><span class="line">CONTAINER ID        IMAGE                        COMMAND                  CREATED             STATUS              PORTS                                              NAMES</span><br><span class="line">5988c4443eb5        quay.io/coreos/etcd:v3.3.9   &quot;etcd --name etcd3...&quot;   37 seconds ago      Up 36 seconds       0.0.0.0:32379-&gt;2379/tcp, 0.0.0.0:32380-&gt;2380/tcp   etcd3</span><br><span class="line">d4fdda6400cc        quay.io/coreos/etcd:v3.3.9   &quot;etcd --name etcd2...&quot;   44 seconds ago      Up 44 seconds       0.0.0.0:22379-&gt;2379/tcp, 0.0.0.0:22380-&gt;2380/tcp   etcd2</span><br><span class="line">af86e5fd2ae5        quay.io/coreos/etcd:v3.3.9   &quot;etcd --name etcd1...&quot;   53 seconds ago      Up 52 seconds       0.0.0.0:2379-2380-&gt;2379-2380/tcp                   etcd1</span><br></pre></td></tr></table></figure>

<h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2><ul>
<li>  <a target="_blank" rel="noopener" href="http://www.dockerinfo.net/document">Docker中文文档</a></li>
<li>  <a target="_blank" rel="noopener" href="https://docs.docker.com/">Docker官方文档</a></li>
<li>  <a target="_blank" rel="noopener" href="https://www.runoob.com/docker/docker-tutorial.html">菜鸟教程</a></li>
</ul>

    </div>

    
    
    

    <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/Docker/" rel="tag"># Docker</a>
          </div>

        

          <div class="post-nav">
            <div class="post-nav-item">
                <a href="/2021/1a4974f1eb10/" rel="prev" title="滴滴数据指标体系建设实践（转）">
                  <i class="fa fa-chevron-left"></i> 滴滴数据指标体系建设实践（转）
                </a>
            </div>
            <div class="post-nav-item">
                <a href="/2022/a8d24e904220/" rel="next" title="分布式一致性">
                  分布式一致性 <i class="fa fa-chevron-right"></i>
                </a>
            </div>
          </div>
    </footer>
  </article>
</div>






    <div class="comments gitalk-container"></div>
</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">


<div class="copyright">
  &copy; 2021 – 
  <span itemprop="copyrightYear">2022</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Jeremyhzf</span>
</div>

    </div>
  </footer>

  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/next-theme-pjax/0.5.0/pjax.min.js" integrity="sha256-3NkoLDrmHLTYj7csHIZSr0MHAFTXth7Ua/DDt4MRUAg=" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/lozad.js/1.16.0/lozad.min.js" integrity="sha256-mOFREFhqmHeQbXpK2lp4nA3qooVgACfh88fpJftLBbc=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/next-boot.js"></script><script src="/js/pjax.js"></script>

  





  




<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/gitalk/1.8.0/gitalk.css" integrity="sha256-AJnUHL7dBv6PGaeyPQJcgQPDjt/Hn/PvYZde1iqfp8U=" crossorigin="anonymous">

<script class="next-config" data-name="gitalk" type="application/json">{"enable":true,"github_id":"jeremyhzf","repo":"jeremyhzf.github.io","client_id":"42c0ba09a8c80255b96d","client_secret":"dfc2f6da92606883935a99606e4bd251d205c88a","admin_user":"jeremyhzf","distraction_free_mode":true,"proxy":"https://cors-anywhere.azm.workers.dev/https://github.com/login/oauth/access_token","language":"zh-CN","js":{"url":"https://cdnjs.cloudflare.com/ajax/libs/gitalk/1.8.0/gitalk.min.js","integrity":"sha256-MVK9MGD/XJaGyIghSVrONSnoXoGh3IFxLw0zfvzpxR4="},"path_md5":"bb163faefbe52e9523fc2255f8acb586"}</script>
<script src="/js/third-party/comments/gitalk.js"></script>

</body>
</html>
